/*
 bootstrap-fileinput v4.3.9
 http://plugins.krajee.com/file-input

 Author: Kartik Visweswaran
 Copyright: 2014 - 2017, Kartik Visweswaran, Krajee.com

 Licensed under the BSD 3-Clause
 https://github.com/kartik-v/bootstrap-fileinput/blob/master/LICENSE.md


*/
(function(g){"function"===typeof define&&define.amd?define(g):"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=g():window.KvSortable=g()})(function(){function g(a,c){if(!a||!a.nodeType||1!==a.nodeType)throw"KvSortable: `el` must be HTMLElement, and not "+{}.toString.call(a);this.el=a;this.options=c=v({},c);a[T]=this;var d={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(a.nodeName)?"li":
">*",ghostClass:"kvsortable-ghost",chosenClass:"kvsortable-chosen",dragClass:"kvsortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,setData:function(a,b){a.setData("Text",b.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"kvsortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0}},f;for(f in d)f in c||(c[f]=d[f]);ea(c);for(var e in this)"_"===e.charAt(0)&&"function"===typeof this[e]&&(this[e]=
this[e].bind(this));this.nativeDraggable=c.forceFallback?!1:ka;b(a,"mousedown",this._onTapStart);b(a,"touchstart",this._onTapStart);b(a,"pointerdown",this._onTapStart);this.nativeDraggable&&(b(a,"dragover",this),b(a,"dragenter",this));W.push(this._onDragOver);c.store&&this.sort(c.store.get(this))}function e(a,b){"clone"!==a.lastPullMode&&(b=!0);C&&C.state!==b&&(f(C,"display",b?"none":""),!b&&C.state&&(a.options.group.revertClone?(t.insertBefore(C,U),a._animate(n,C)):t.insertBefore(C,n)),C.state=b)}
function z(b,c,d){if(b){d=d||F;do if(">*"===c&&b.parentNode===d||w(b,c))return b;while(b=a(b))}return null}function a(a){var b=a.host;return b&&b.nodeType?b:a.parentNode}function b(a,b,c){a.addEventListener(b,c,aa)}function c(a,b,c){a.removeEventListener(b,c,aa)}function d(a,b,c){if(a)if(a.classList)a.classList[c?"add":"remove"](b);else{var d=(" "+a.className+" ").replace(fa," ").replace(" "+b+" "," ");a.className=(d+(c?" "+b:"")).replace(fa," ")}}function f(a,b,c){var d=a&&a.style;if(d){if(void 0===
c)return F.defaultView&&F.defaultView.getComputedStyle?c=F.defaultView.getComputedStyle(a,""):a.currentStyle&&(c=a.currentStyle),void 0===b?c:c[b];b in d||(b="-webkit-"+b);d[b]=c+("string"===typeof c?"":"px")}}function h(a,b,c){if(a){a=a.getElementsByTagName(b);b=0;var d=a.length;if(c)for(;b<d;b++)c(a[b],b);return a}return[]}function k(a,b,c,d,f,e,h){a=a||b[T];var E=F.createEvent("Event"),k=a.options,g="on"+c.charAt(0).toUpperCase()+c.substr(1);E.initEvent(c,!0,!0);E.to=b;E.from=f||b;E.item=d||b;
E.clone=C;E.oldIndex=e;E.newIndex=h;b.dispatchEvent(E);k[g]&&k[g].call(a,E)}function m(a,b,c,d,f,e,h){var E=a[T],k=E.options.onMove,g;var B=F.createEvent("Event");B.initEvent("move",!0,!0);B.to=b;B.from=a;B.dragged=c;B.draggedRect=d;B.related=f||b;B.relatedRect=e||b.getBoundingClientRect();a.dispatchEvent(B);k&&(g=k.call(E,B,h));return g}function l(a){a.draggable=!1}function r(){ba=!1}function p(a){a=a.tagName+a.className+a.src+a.href+a.textContent;for(var b=a.length,c=0;b--;)c+=a.charCodeAt(b);return c.toString(36)}
function q(a,b){var c=0;if(!a||!a.parentNode)return-1;for(;a&&(a=a.previousElementSibling);)"TEMPLATE"===a.nodeName.toUpperCase()||">*"!==b&&!w(a,b)||c++;return c}function w(a,b){if(a){b=b.split(".");var c=b.shift().toUpperCase(),d=new RegExp("\\s("+b.join("|")+")(?=\\s)","g");return(""===c||a.nodeName.toUpperCase()==c)&&(!b.length||((" "+a.className+" ").match(d)||[]).length==b.length)}return!1}function u(a,b){var c,d;return function(){void 0===c&&(c=arguments,d=this,setTimeout(function(){1===c.length?
a.call(d,c[0]):a.apply(d,c);c=void 0},b))}}function v(a,b){if(a&&b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function Q(a){return ha?ha(a).clone(!0)[0]:ca&&ca.dom?ca.dom(a).cloneNode(!0):a.cloneNode(!0)}function H(a){a=a.getElementsByTagName("input");for(var b=a.length;b--;){var c=a[b];c.checked&&da.push(c)}}if("undefined"==typeof window||!window.document)return function(){throw Error("KvSortable.js requires a window with a document");};var n,K,x,C,t,U,y,A,I,N,O,X,L,J,D,G,Y,R={},S,
M,Z,fa=/\s+/g,la=/left|right|inline/,T="KvSortable"+(new Date).getTime(),P=window,F=P.document,ia=P.parseInt,ha=P.jQuery||P.Zepto,ca=P.Polymer,aa=!1,ka=!!("draggable"in F.createElement("div")),ja=function(a){if(navigator.userAgent.match(/Trident.*rv[ :]?11\./))return!1;a=F.createElement("x");a.style.cssText="pointer-events:auto";return"auto"===a.style.pointerEvents}(),ba=!1,V=Math.abs,ma=Math.min,da=[],W=[],na=u(function(a,b,c){if(c&&b.scroll){var d=c[T],f=b.scrollSensitivity,e=b.scrollSpeed,h=a.clientX,
k=a.clientY,g=window.innerWidth,E=window.innerHeight,n,m;if(I!==c&&(A=b.scroll,I=c,N=b.scrollFn,!0===A)){A=c;do if(A.offsetWidth<A.scrollWidth||A.offsetHeight<A.scrollHeight)break;while(A=A.parentNode)}if(A){var B=A;b=A.getBoundingClientRect();var l=(V(b.right-h)<=f)-(V(b.left-h)<=f);var t=(V(b.bottom-k)<=f)-(V(b.top-k)<=f)}l||t||(l=(g-h<=f)-(h<=f),t=(E-k<=f)-(k<=f),(l||t)&&(B=P));if(R.vx!==l||R.vy!==t||R.el!==B)R.el=B,R.vx=l,R.vy=t,clearInterval(R.pid),B&&(R.pid=setInterval(function(){m=t?t*e:0;
n=l?l*e:0;if("function"===typeof N)return N.call(d,n,m,a);B===P?P.scrollTo(P.pageXOffset+n,P.pageYOffset+m):(B.scrollTop+=m,B.scrollLeft+=n)},24))}},30),ea=function(a){function b(a,b){if(void 0===a||!0===a)a=c.name;return"function"===typeof a?a:function(c,d){var f=d.options.group.name;return b?a:a&&(a.join?-1<a.indexOf(f):f==a)}}var c={},d=a.group;d&&"object"==typeof d||(d={name:d});c.name=d.name;c.checkPull=b(d.pull,!0);c.checkPut=b(d.put);c.revertClone=d.revertClone;a.group=c};g.prototype={constructor:g,
_onTapStart:function(a){var b=this,c=this.el,d=this.options,f=d.preventOnFilter,e=a.type,h=a.touches&&a.touches[0],g=(h||a).target,E=a.target.shadowRoot&&a.path[0]||g,m=d.filter;H(c);if(!(n||"mousedown"===e&&0!==a.button||d.disabled)&&(g=z(g,d.draggable,c))&&y!==g){var l=q(g,d.draggable);if("function"===typeof m){if(m.call(this,a,g,this)){k(b,E,"filter",g,c,l);f&&a.preventDefault();return}}else if(m&&(m=m.split(",").some(function(a){if(a=z(E,a.trim(),c))return k(b,a,"filter",g,c,l),!0}))){f&&a.preventDefault();
return}d.handle&&!z(E,d.handle,c)||this._prepareDragStart(a,h,g,l)}},_prepareDragStart:function(a,c,f,e){var g=this,E=g.el,m=g.options,B=E.ownerDocument;f&&!n&&f.parentNode===E&&(S=a,t=E,n=f,K=n.parentNode,U=n.nextSibling,y=f,G=m.group,J=e,this._lastX=(c||a).clientX,this._lastY=(c||a).clientY,n.style["will-change"]="transform",f=function(){g._disableDelayedDrag();n.draggable=g.nativeDraggable;d(n,m.chosenClass,!0);g._triggerDragStart(a,c);k(g,t,"choose",n,t,J)},m.ignore.split(",").forEach(function(a){h(n,
a.trim(),l)}),b(B,"mouseup",g._onDrop),b(B,"touchend",g._onDrop),b(B,"touchcancel",g._onDrop),b(B,"pointercancel",g._onDrop),b(B,"selectstart",g),m.delay?(b(B,"mouseup",g._disableDelayedDrag),b(B,"touchend",g._disableDelayedDrag),b(B,"touchcancel",g._disableDelayedDrag),b(B,"mousemove",g._disableDelayedDrag),b(B,"touchmove",g._disableDelayedDrag),b(B,"pointermove",g._disableDelayedDrag),g._dragStartTimer=setTimeout(f,m.delay)):f())},_disableDelayedDrag:function(){var a=this.el.ownerDocument;clearTimeout(this._dragStartTimer);
c(a,"mouseup",this._disableDelayedDrag);c(a,"touchend",this._disableDelayedDrag);c(a,"touchcancel",this._disableDelayedDrag);c(a,"mousemove",this._disableDelayedDrag);c(a,"touchmove",this._disableDelayedDrag);c(a,"pointermove",this._disableDelayedDrag)},_triggerDragStart:function(a,c){(c=c||("touch"==a.pointerType?a:null))?(S={target:n,clientX:c.clientX,clientY:c.clientY},this._onDragStart(S,"touch")):this.nativeDraggable?(b(n,"dragend",this),b(t,"dragstart",this._onDragStart)):this._onDragStart(S,
!0);try{F.selection?setTimeout(function(){F.selection.empty()}):window.getSelection().removeAllRanges()}catch(oa){}},_dragStarted:function(){if(t&&n){var a=this.options;d(n,a.ghostClass,!0);d(n,a.dragClass,!1);g.active=this;k(this,t,"start",n,t,J)}else this._nulling()},_emulateDragOver:function(){if(M&&(this._lastX!==M.clientX||this._lastY!==M.clientY)){this._lastX=M.clientX;this._lastY=M.clientY;ja||f(x,"display","none");var a=F.elementFromPoint(M.clientX,M.clientY),b=a,c=W.length;if(b){do{if(b[T]){for(;c--;)W[c]({clientX:M.clientX,
clientY:M.clientY,target:a,rootEl:b});break}a=b}while(b=b.parentNode)}ja||f(x,"display","")}},_onTouchMove:function(a){if(S){var b=this.options,c=b.fallbackTolerance,d=b.fallbackOffset;b=a.touches?a.touches[0]:a;var e=b.clientX-S.clientX+d.x;d=b.clientY-S.clientY+d.y;e=a.touches?"translate3d("+e+"px,"+d+"px,0)":"translate("+e+"px,"+d+"px)";if(!g.active){if(c&&ma(V(b.clientX-this._lastX),V(b.clientY-this._lastY))<c)return;this._dragStarted()}this._appendGhost();Z=!0;M=b;f(x,"webkitTransform",e);f(x,
"mozTransform",e);f(x,"msTransform",e);f(x,"transform",e);a.preventDefault()}},_appendGhost:function(){if(!x){var a=n.getBoundingClientRect(),b=f(n),c=this.options;x=n.cloneNode(!0);d(x,c.ghostClass,!1);d(x,c.fallbackClass,!0);d(x,c.dragClass,!0);f(x,"top",a.top-ia(b.marginTop,10));f(x,"left",a.left-ia(b.marginLeft,10));f(x,"width",a.width);f(x,"height",a.height);f(x,"opacity","0.8");f(x,"position","fixed");f(x,"zIndex","100000");f(x,"pointerEvents","none");c.fallbackOnBody&&F.body.appendChild(x)||
t.appendChild(x);b=x.getBoundingClientRect();f(x,"width",2*a.width-b.width);f(x,"height",2*a.height-b.height)}},_onDragStart:function(a,c){var e=a.dataTransfer,h=this.options;this._offUpEvents();G.checkPull(this,this,n,a)&&(C=Q(n),C.draggable=!1,C.style["will-change"]="",f(C,"display","none"),d(C,this.options.chosenClass,!1),t.insertBefore(C,n),k(this,t,"clone",n));d(n,h.dragClass,!0);c?("touch"===c?(b(F,"touchmove",this._onTouchMove),b(F,"touchend",this._onDrop),b(F,"touchcancel",this._onDrop),b(F,
"pointermove",this._onTouchMove),b(F,"pointerup",this._onDrop)):(b(F,"mousemove",this._onTouchMove),b(F,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,50)):(e&&(e.effectAllowed="move",h.setData&&h.setData.call(this,e,n)),b(F,"drop",this),setTimeout(this._dragStarted,0))},_onDragOver:function(a){var b=this.el,c;var d=this.options;var h=d.group;var k=g.active,l=G===h,E=!1,p=d.sort;void 0!==a.preventDefault&&(a.preventDefault(),!d.dragoverBubble&&a.stopPropagation());if(!n.animated&&
(Z=!0,k&&!d.disabled&&(l?p||(c=!t.contains(n)):Y===this||(k.lastPullMode=G.checkPull(this,k,n,a))&&h.checkPut(this,k,n,a))&&(void 0===a.rootEl||a.rootEl===this.el)&&(na(a,d,this.el),!ba)))if(h=z(a.target,d.draggable,b),d=n.getBoundingClientRect(),Y!==this&&(Y=this,E=!0),c)e(k,!0),K=t,C||U?t.insertBefore(n,C||U):p||t.appendChild(n);else if(!(c=0===b.children.length||b.children[0]===x)&&(c=b===a.target)&&(h=b.lastElementChild,c=h.getBoundingClientRect(),c=h=(5<a.clientY-(c.top+c.height)||5<a.clientX-
(c.right+c.width))&&h),c){if(h){if(h.animated)return;var q=h.getBoundingClientRect()}e(k,l);!1!==m(t,b,n,d,h,q,a)&&(n.contains(b)||(b.appendChild(n),K=b),this._animate(d,n),h&&this._animate(q,h))}else if(h&&!h.animated&&h!==n&&void 0!==h.parentNode[T]){O!==h&&(O=h,X=f(h),L=f(h.parentNode));q=h.getBoundingClientRect();var v=q.right-q.left;c=q.bottom-q.top;var u=la.test(X.cssFloat+X.display)||"flex"==L.display&&0===L["flex-direction"].indexOf("row");p=h.offsetWidth>n.offsetWidth;var H=h.offsetHeight>
n.offsetHeight;v=.5<(u?(a.clientX-q.left)/v:(a.clientY-q.top)/c);var y=h.nextElementSibling,w=m(t,b,n,d,h,q,a),A=!1;!1!==w&&(ba=!0,setTimeout(r,30),e(k,l),1===w||-1===w?A=1===w:u?(k=n.offsetTop,l=h.offsetTop,A=k===l?h.previousElementSibling===n&&!p||v&&p:h.previousElementSibling===n||n.previousElementSibling===h?.5<(a.clientY-q.top)/c:l>k):E||(A=y!==n&&!H||v&&H),n.contains(b)||(A&&!y?b.appendChild(n):h.parentNode.insertBefore(n,A?y:h)),K=n.parentNode,this._animate(d,n),this._animate(q,h))}},_animate:function(a,
b){var c=this.options.animation;if(c){var d=b.getBoundingClientRect();1===a.nodeType&&(a=a.getBoundingClientRect());f(b,"transition","none");f(b,"transform","translate3d("+(a.left-d.left)+"px,"+(a.top-d.top)+"px,0)");b.offsetWidth;f(b,"transition","all "+c+"ms");f(b,"transform","translate3d(0,0,0)");clearTimeout(b.animated);b.animated=setTimeout(function(){f(b,"transition","");f(b,"transform","");b.animated=!1},c)}},_offUpEvents:function(){var a=this.el.ownerDocument;c(F,"touchmove",this._onTouchMove);
c(F,"pointermove",this._onTouchMove);c(a,"mouseup",this._onDrop);c(a,"touchend",this._onDrop);c(a,"pointerup",this._onDrop);c(a,"touchcancel",this._onDrop);c(a,"selectstart",this)},_onDrop:function(a){var b=this.el,f=this.options;clearInterval(this._loopId);clearInterval(R.pid);clearTimeout(this._dragStartTimer);c(F,"mousemove",this._onTouchMove);this.nativeDraggable&&(c(F,"drop",this),c(b,"dragstart",this._onDragStart));this._offUpEvents();if(a&&(Z&&(a.preventDefault(),!f.dropBubble&&a.stopPropagation()),
x&&x.parentNode.removeChild(x),(t===K||"clone"!==g.active.lastPullMode)&&C&&C.parentNode.removeChild(C),n&&(this.nativeDraggable&&c(n,"dragend",this),l(n),n.style["will-change"]="",d(n,this.options.ghostClass,!1),d(n,this.options.chosenClass,!1),t!==K?(D=q(n,f.draggable),0<=D&&(k(null,K,"add",n,t,J,D),k(this,t,"remove",n,t,J,D),k(null,K,"sort",n,t,J,D),k(this,t,"sort",n,t,J,D))):n.nextSibling!==U&&(D=q(n,f.draggable),0<=D&&(k(this,t,"update",n,t,J,D),k(this,t,"sort",n,t,J,D))),g.active))){if(null==
D||-1===D)D=J;k(this,t,"end",n,t,J,D);this.save()}this._nulling()},_nulling:function(){t=n=K=x=U=C=y=A=I=S=M=Z=D=O=X=Y=G=g.active=null;da.forEach(function(a){a.checked=!0});da.length=0},handleEvent:function(a){switch(a.type){case "drop":case "dragend":this._onDrop(a);break;case "dragover":case "dragenter":n&&(this._onDragOver(a),a.dataTransfer&&(a.dataTransfer.dropEffect="move"),a.preventDefault());break;case "selectstart":a.preventDefault()}},toArray:function(){for(var a=[],b,c=this.el.children,
d=0,f=c.length,e=this.options;d<f;d++)b=c[d],z(b,e.draggable,this.el)&&a.push(b.getAttribute(e.dataIdAttr)||p(b));return a},sort:function(a){var b={},c=this.el;this.toArray().forEach(function(a,d){var f=c.children[d];z(f,this.options.draggable,c)&&(b[a]=f)},this);a.forEach(function(a){b[a]&&(c.removeChild(b[a]),c.appendChild(b[a]))})},save:function(){var a=this.options.store;a&&a.set(this)},closest:function(a,b){return z(a,b||this.options.draggable,this.el)},option:function(a,b){var c=this.options;
if(void 0===b)return c[a];c[a]=b;"group"===a&&ea(c)},destroy:function(){var a=this.el;a[T]=null;c(a,"mousedown",this._onTapStart);c(a,"touchstart",this._onTapStart);c(a,"pointerdown",this._onTapStart);this.nativeDraggable&&(c(a,"dragover",this),c(a,"dragenter",this));Array.prototype.forEach.call(a.querySelectorAll("[draggable]"),function(a){a.removeAttribute("draggable")});W.splice(W.indexOf(this._onDragOver),1);this._onDrop();this.el=a=null}};b(F,"touchmove",function(a){g.active&&a.preventDefault()});
try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){aa={capture:!1,passive:!1}}}))}catch(E){}g.utils={on:b,off:c,css:f,find:h,is:function(a,b){return!!z(a,b,a)},extend:v,throttle:u,closest:z,toggleClass:d,clone:Q,index:q};g.create=function(a,b){return new g(a,b)};g.version="1.5.1";return g});
(function(g){"function"===typeof define&&define.amd?define(["jquery"],g):g(jQuery)})(function(g){g.fn.kvsortable=function(e){var z,a=arguments;this.each(function(){var b=g(this),c=b.data("kvsortable");c||!(e instanceof Object)&&e||(c=new KvSortable(this,e),b.data("kvsortable",c));c&&("widget"===e?z=c:"destroy"===e?(c.destroy(),b.removeData("kvsortable")):"function"===typeof c[e]?z=c[e].apply(c,[].slice.call(a,1)):e in c.options&&(z=c.option.apply(c,a)))});return void 0===z?this:z}});
$(function(){$(".file-preview").hide();$(".input-group-btn").on("click",function(){$(".file-preview").show()})});
(function(g){"function"===typeof define&&define.amd?define(["jquery"],g):"object"===typeof module&&module.exports?module.exports=g(require("jquery")):g(window.jQuery)})(function(g){g.fn.fileinputLocales={};g.fn.fileinputThemes={};var e={FRAMES:".kv-preview-thumb",SORT_CSS:"file-sortable",STYLE_SETTING:'style="width:{width};height:{height};"',OBJECT_PARAMS:'<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other" style="display="none">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>',
MODAL_ID:"kvFileinputModal",MODAL_EVENTS:["show","shown","hide","hidden","loaded"],objUrl:window.URL||window.webkitURL,compare:function(a,b,c){return void 0!==a&&(c?a===b:a.match(b))},isIE:function(a){if("Microsoft Internet Explorer"!==navigator.appName)return!1;if(10===a)return(new RegExp("msie\\s"+a,"i")).test(navigator.userAgent);var b=document.createElement("div");b.innerHTML="\x3c!--[if IE "+a+"]> <i></i> <![endif]--\x3e";a=b.getElementsByTagName("i").length;document.body.appendChild(b);b.parentNode.removeChild(b);
return a},initModal:function(a){var b=g("body");b.length&&a.appendTo(b)},isEmpty:function(a,b){return void 0===a||null===a||0===a.length||b&&""===g.trim(a)},isArray:function(a){return Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)},ifSet:function(a,b,c){return b&&"object"===typeof b&&a in b?b[a]:c||""},cleanArray:function(a){a instanceof Array||(a=[]);return a.filter(function(a){return void 0!==a&&null!==a})},spliceArray:function(a,b){var c,d=0,f=[];if(!(a instanceof Array))return[];
for(c=0;c<a.length;c++)c!==b&&(f[d]=a[c],d++);return f},getNum:function(a,b){b=b||0;if("number"===typeof a)return a;"string"===typeof a&&(a=parseFloat(a));return isNaN(a)?b:a},hasFileAPISupport:function(){return!(!window.File||!window.FileReader)},hasDragDropSupport:function(){var a=document.createElement("div");return!e.isIE(9)&&(void 0!==a.draggable||void 0!==a.ondragstart&&void 0!==a.ondrop)},hasFileUploadSupport:function(){return e.hasFileAPISupport()&&window.FormData},addCss:function(a,b){a.removeClass(b).addClass(b)},
getElement:function(a,b,c){return e.isEmpty(a)||e.isEmpty(a[b])?c:g(a[b])},uniqId:function(){return Math.round((new Date).getTime()+100*Math.random())},htmlEncode:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags:function(a,b){var c=a;if(!b)return c;g.each(b,function(a,b){"function"===typeof b&&(b=b());c=c.split(a).join(b)});return c},cleanMemory:function(a){a=a.is("img")?a.attr("src"):a.find("source").attr("src");
e.objUrl.revokeObjectURL(a)},findFileName:function(a){var b=a.lastIndexOf("/");-1===b&&(b=a.lastIndexOf("\\"));return a.split(a.substring(b,b+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(a){var b=document,c=b.documentElement;c&&a&&!e.checkFullScreen()?c.requestFullscreen?c.requestFullscreen():c.msRequestFullscreen?c.msRequestFullscreen():c.mozRequestFullScreen?
c.mozRequestFullScreen():c.webkitRequestFullscreen&&c.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):b.exitFullscreen?b.exitFullscreen():b.msExitFullscreen?b.msExitFullscreen():b.mozCancelFullScreen?b.mozCancelFullScreen():b.webkitExitFullscreen&&b.webkitExitFullscreen()},moveArray:function(a,b,c){if(c>=a.length)for(var d=c-a.length;d--+1;)a.push(void 0);a.splice(c,0,a.splice(b,1)[0]);return a},cleanZoomCache:function(a){var b=a.closest(".kv-zoom-cache-theme");b.length||(b=a.closest(".kv-zoom-cache"));
b.remove()}};var z=function(a,b){this.$element=g(a);this._validate()&&(this.isPreviewable=e.hasFileAPISupport(),this.isIE9=e.isIE(9),this.isIE10=e.isIE(10),this.isPreviewable||this.isIE9?(this._init(b),this._listen()):this.$element.removeClass("file-loading"))};z.prototype={constructor:z,_init:function(a){var b=this,c=b.$element;b.options=a;g.each(a,function(a,c){switch(a){case "minFileCount":case "maxFileCount":case "maxFileSize":b[a]=e.getNum(c);break;default:b[a]=c}});b.$form=c.closest("form");
b._initTemplateDefaults();b.fileInputCleared=!1;b.fileBatchCompleted=!0;b.isPreviewable||(b.showPreview=!1);b.uploadFileAttr=e.isEmpty(c.attr("name"))?"file_data":c.attr("name");b.reader=null;b.formdata={};b.clearStack();b.uploadCount=0;b.uploadStatus={};b.uploadLog=[];b.uploadAsyncCount=0;b.loadedImages=[];b.totalImagesCount=0;b.ajaxRequests=[];b.isError=!1;b.ajaxAborted=!1;b.cancelling=!1;var d=b._getLayoutTemplate("progress");b.progressTemplate=d.replace("{class}",b.progressClass);b.progressCompleteTemplate=
d.replace("{class}",b.progressCompleteClass);b.progressErrorTemplate=d.replace("{class}",b.progressErrorClass);b.dropZoneEnabled=e.hasDragDropSupport()&&b.dropZoneEnabled;b.isDisabled=c.attr("disabled")||c.attr("readonly");b.isUploadable=e.hasFileUploadSupport()&&!e.isEmpty(b.uploadUrl);b.isClickable=b.browseOnZoneClick&&b.showPreview&&(b.isUploadable&&b.dropZoneEnabled||!e.isEmpty(b.defaultPreviewContent));b.slug="function"===typeof a.slugCallback?a.slugCallback:b._slugDefault;b.mainTemplate=b.showCaption?
b._getLayoutTemplate("main1"):b._getLayoutTemplate("main2");b.captionTemplate=b._getLayoutTemplate("caption");b.previewGenericTemplate=b._getPreviewTemplate("generic");b.resizeImage&&(b.maxImageWidth||b.maxImageHeight)&&(b.imageCanvas=document.createElement("canvas"),b.imageCanvasContext=b.imageCanvas.getContext("2d"));e.isEmpty(c.attr("id"))&&c.attr("id",e.uniqId());b.namespace=".fileinput_"+c.attr("id").replace(/-/g,"_");void 0===b.$container?b.$container=b._createContainer():b._refreshContainer();
d=b.$container;b.$dropZone=d.find(".file-drop-zone");b.$progress=d.find(".kv-upload-progress");b.$btnUpload=d.find(".fileinput-upload");b.$captionContainer=e.getElement(a,"elCaptionContainer",d.find(".file-caption"));b.$caption=e.getElement(a,"elCaptionText",d.find(".file-caption-name"));b.$previewContainer=e.getElement(a,"elPreviewContainer",d.find(".file-preview"));b.$preview=e.getElement(a,"elPreviewImage",d.find(".file-preview-thumbnails"));b.$previewStatus=e.getElement(a,"elPreviewStatus",d.find(".file-preview-status"));
b.$errorContainer=e.getElement(a,"elErrorContainer",b.$previewContainer.find(".kv-fileinput-error"));e.isEmpty(b.msgErrorClass)||e.addCss(b.$errorContainer,b.msgErrorClass);b.$errorContainer.hide();b.previewInitId="preview-"+e.uniqId();b._initPreviewCache();b._initPreview(!0);b._initPreviewActions();b._setFileDropZoneTitle();c.removeClass("file-loading");c.attr("disabled")&&b.disable();b._initZoom()},_initTemplateDefaults:function(){var a=this;var b='<div id="'+e.MODAL_ID+'" class="file-zoom-dialog modal fade" tabindex="-1" aria-labelledby="'+
e.MODAL_ID+'Label"></div>';"   \n";'    </div>\n    <div class="clearfix"></div>\n</div>';var c='<div class="kv-preview-data file-preview-html" title="{caption}" '+e.STYLE_SETTING+">{data}</div>\n";var d='<img src="{data}" class="file-preview-image kv-preview-data" title="{caption}" alt="{caption}" '+e.STYLE_SETTING+">\n";var f='<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly '+e.STYLE_SETTING+">{data}</textarea>\n";var h='<video class="kv-preview-data file-preview-video" width="{width}" height="{height}" controls>\n<source src="{data}" type="{type}">\n'+
e.DEFAULT_PREVIEW+"\n</video>\n";a.defaults={layoutTemplates:{main1:'{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   </div>\n</div>',main2:'{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',preview:'<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',
close:"<div></div>\n",fileIcon:'<i class="glyphicon glyphicon-file kv-caption-icon"></i>',caption:'<div tabindex="500" class="form-control file-caption {class}">\n</div>\n',modalMain:b,modal:'<div class="modal-dialog modal-lg" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <div class="kv-zoom-actions pull-right">{toggleheader}{fullscreen}{borderless}{close}</div>\n      <h3 class="modal-title">{heading} <small><span class="kv-zoom-title"></span></small></h3>\n    </div>\n    <div class="modal-body">\n      <div class="floating-buttons"></div>\n      <div class="kv-zoom-body file-zoom-content"></div>\n{prev} {next}\n    </div>\n  </div>\n</div>\n',
progress:'<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {status}\n     </div>\n</div>',size:" <samp>({sizeText})</samp>",footer:'<div class="file-thumbnail-footer"> <div class="remove-  "> <i class="fa fa-trash" aria-hidden="true"></i></div>\n    <div class="file-footer-caption" title="{caption}">{caption}<br>{size}</div>  \n    {progress} {actions}\n</div>',actions:'<div></div>\n{drag}\n<div class="file-actions">\n    <div class="file-footer-buttons">\n',
actionDelete:'<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n',actionUpload:'<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}</button>',actionZoom:'<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}</button>',actionDrag:'<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}</span>',btnDefault:'<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</button>',
btnLink:'<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</a>',btnBrowse:'<div tabindex="500" class="{css}" {status}>{icon} {label}</div>',zoomCache:'<div class="kv-zoom-cache" style="display:none">{zoomContent}</div>'},previewMarkupTags:{tagBefore1:'  <div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"> <div class="kv-file-content">\n',tagBefore2:'  <div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}" title="{caption}"><div class="kv-file-content">\n',
tagAfter:"</div>{footer}\n</div> \n"},previewContentTemplates:{generic:"{content}\n",html:c,image:d,text:f,video:h,audio:'<div class="file-preview-audio"><audio class="kv-preview-data" controls>\n<source src="{data}" type="{type}">\n'+e.DEFAULT_PREVIEW+"\n</audio></div>\n",flash:'<object class="kv-preview-data file-object" type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+e.OBJECT_PARAMS+" "+e.DEFAULT_PREVIEW+"\n</object>\n",object:'<object class="kv-preview-data file-object" data="{data}" type="{type}" width="{width}" height="{height}">\n<param name="movie" value="{caption}" />\n'+
e.OBJECT_PARAMS+" "+e.DEFAULT_PREVIEW+"\n</object>\n",pdf:'<embed class="kv-preview-data" src="{data}" width="{width}" height="{height}" type="application/pdf">\n',other:'<div class="kv-preview-data file-preview-other-frame">\n'+e.DEFAULT_PREVIEW+"\n</div>\n"},allowedPreviewTypes:"image html text video audio flash pdf object".split(" "),previewTemplates:{},previewSettings:{image:{width:"100px",height:"100px"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},video:{width:"213px",
height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"auto"},pdf:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"100%",height:"100%","min-height":"480px"},text:{width:"100%",height:"100%","min-height":"480px"},video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",
height:"480px"},object:{width:"auto",height:"100%","min-height":"480px"},pdf:{width:"100%",height:"100%","min-height":"480px"},other:{width:"auto",height:"100%","min-height":"480px"}},fileTypeSettings:{image:function(a,b){return e.compare(a,"image.*")||e.compare(b,/\.(gif|png|jpe?g)$/i)},html:function(a,b){return e.compare(a,"text/html")||e.compare(b,/\.(htm|html)$/i)},text:function(a,b){return e.compare(a,"text.*")||e.compare(b,/\.(xml|javascript)$/i)||e.compare(b,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},
video:function(a,b){return e.compare(a,"video.*")&&(e.compare(a,/(ogg|mp4|mp?g|mov|webm|3gp|avi)$/i)||e.compare(b,/\.(og?|mp4|webm|mp?g|mov|3gp|avi)$/i))},audio:function(a,b){return e.compare(a,"audio.*")&&(e.compare(b,/(ogg|mp3|mp?g|wav)$/i)||e.compare(b,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(a,b){return e.compare(a,"application/x-shockwave-flash",!0)||e.compare(b,/\.(swf)$/i)},pdf:function(a,b){return e.compare(a,"application/pdf",!0)||e.compare(b,/\.(pdf)$/i)},object:function(){return!0},other:function(){return!0}},
fileActionSettings:{showRemove:!0,showUpload:!0,showZoom:!0,showDrag:!0,removeIcon:'<i class="fa fa-trash" aria-hidden="true"></i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"></i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",zoomIcon:'<i class="fa fa-trash" aria-hidden="true"></i>',zoomClass:"btn btn-xs btn-default",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-menu-hamburger"></i>',
dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."}};g.each(a.defaults,function(b,c){"allowedPreviewTypes"===b?
void 0===a.allowedPreviewTypes&&(a.allowedPreviewTypes=c):a[b]=g.extend(!0,{},c,a[b])});a._initPreviewTemplates()},_initPreviewTemplates:function(){var a=this,b=a.previewMarkupTags,c,d=b.tagAfter;g.each(a.defaults.previewContentTemplates,function(f,h){if(e.isEmpty(a.previewTemplates[f])){c=b.tagBefore2;if("generic"===f||"image"===f||"html"===f||"text"===f)c=b.tagBefore1;a.previewTemplates[f]=c+h+d}})},_initPreviewCache:function(){var a=this;a.previewCache={data:{},init:function(){var b=a.initialPreview;
0<b.length&&!e.isArray(b)&&(b=b.split(a.initialPreviewDelimiter));a.previewCache.data={content:b,config:a.initialPreviewConfig,tags:a.initialPreviewThumbTags}},fetch:function(){return a.previewCache.data.content.filter(function(a){return null!==a})},count:function(b){return a.previewCache.data&&a.previewCache.data.content?b?a.previewCache.data.content.length:a.previewCache.fetch().length:0},get:function(b,c){var d="init_"+b,f=a.previewCache.data,h=f.config[b],k=f.content[b],m=a.previewInitId+"-"+
d,l=e.ifSet("previewAsData",h,a.initialPreviewAsData),r=function(b,c,d,f,h,g,k,m,l){m=" file-preview-initial "+e.SORT_CSS+(m?" "+m:"");return a._generatePreviewTemplate(b,c,d,f,h,!1,null,m,g,k,l)};if(!k)return"";c=void 0===c?!0:c;var p=e.ifSet("type",h,a.initialPreviewFileType||"generic");var q=e.ifSet("filename",h,e.ifSet("caption",h));var w=e.ifSet("filetype",h,p);var u=a.previewCache.footer(b,c,h&&h.size||null);var v=e.ifSet("frameClass",h);d=l?r(p,k,q,w,m,u,d,v):r("generic",k,q,w,m,u,d,v,p).replace(/\{content}/g,
f.content[b]);f.tags.length&&f.tags[b]&&(d=e.replaceTags(d,f.tags[b]));e.isEmpty(h)||e.isEmpty(h.frameAttr)||(f=g(document.createElement("div")).html(d),f.find(".file-preview-initial").attr(h.frameAttr),d=f.html(),f.remove());return d},add:function(b,c,d,f){var h=a.previewCache.data;e.isArray(b)||(b=b.split(a.initialPreviewDelimiter));f?(f=h.content.push(b)-1,h.config[f]=c,h.tags[f]=d):(f=b.length-1,h.content=b,h.config=c,h.tags=d);a.previewCache.data=h;return f},set:function(b,c,d,f){var h=a.previewCache.data;
if(b&&b.length&&(e.isArray(b)||(b=b.split(a.initialPreviewDelimiter)),b.filter(function(a){return null!==a}).length)){void 0===h.content&&(h.content=[]);void 0===h.config&&(h.config=[]);void 0===h.tags&&(h.tags=[]);if(f){for(f=0;f<b.length;f++)b[f]&&h.content.push(b[f]);for(f=0;f<c.length;f++)c[f]&&h.config.push(c[f]);for(f=0;f<d.length;f++)d[f]&&h.tags.push(d[f])}else h.content=b,h.config=c,h.tags=d;a.previewCache.data=h}},unset:function(b){var c=a.previewCache.count();c&&(1===c?(a.previewCache.data.content=
[],a.previewCache.data.config=[],a.previewCache.data.tags=[],a.initialPreview=[],a.initialPreviewConfig=[],a.initialPreviewThumbTags=[]):(a.previewCache.data.content[b]=null,a.previewCache.data.config[b]=null,a.previewCache.data.tags[b]=null))},out:function(){var b="";var c=a.previewCache.count(!0);var d;if(0===c)return{content:"",caption:""};for(d=0;d<c;d++)b+=a.previewCache.get(d);c=a._getMsgSelected(a.previewCache.count());return{content:b,caption:c}},footer:function(b,c,d){var f=a.previewCache.data;
if(!f||!f.config||0===f.config.length||e.isEmpty(f.config[b]))return"";c=void 0===c?!0:c;var h=f.config[b];b=e.ifSet("caption",h);f="";var g=e.ifSet("width",h,"auto"),m=e.ifSet("url",h,!1),l=e.ifSet("key",h,null),r=a.fileActionSettings,p=e.ifSet("showDelete",h,!0),q=e.ifSet("showZoom",h,r.showZoom);h=e.ifSet("showDrag",h,r.showDrag);a.initialPreviewShowDelete&&(f=a._renderFileActions(!1,p,q,h,!1===m&&c,m,l,!0));return a._getLayoutTemplate("footer").replace(/\{progress}/g,a._renderThumbProgress()).replace(/\{actions}/g,
f).replace(/\{caption}/g,b).replace(/\{size}/g,a._getSize(d)).replace(/\{width}/g,g).replace(/\{indicator}/g,"").replace(/\{indicatorTitle}/g,"")}};a.previewCache.init()},_handler:function(a,b,c){var d=this.namespace;b=b.split(" ").join(d+" ")+d;if(a&&a.length)a.off(b).on(b,c)},_log:function(a){var b=this.$element.attr("id");b&&(a='"'+b+'": '+a);"undefined"!==typeof window.console.log?window.console.log(a):window.alert(a)},_validate:function(){var a="file"===this.$element.attr("type");a||this._log('The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.');
return a},_errorsExist:function(){if(this.$errorContainer.find("li").length)return!0;var a=g(document.createElement("div")).html(this.$errorContainer.html());a.find("span.kv-error-close").remove();a.find("ul").remove();return g.trim(a.text()).length?!0:!1},_errorHandler:function(a,b){var c=a.target.error;c.code===c.NOT_FOUND_ERR?this._showError(this.msgFileNotFound.replace("{name}",b)):c.code===c.SECURITY_ERR?this._showError(this.msgFileSecured.replace("{name}",b)):c.code===c.NOT_READABLE_ERR?this._showError(this.msgFileNotReadable.replace("{name}",
b)):c.code===c.ABORT_ERR?this._showError(this.msgFilePreviewAborted.replace("{name}",b)):this._showError(this.msgFilePreviewError.replace("{name}",b))},_addError:function(a){var b=this.$errorContainer;a&&b.length&&(b.html(this.errorCloseButton+a),this._handler(b.find(".kv-error-close"),"click",function(){b.fadeOut("slow")}))},_resetErrors:function(a){var b=this.$errorContainer;this.isError=!1;this.$container.removeClass("has-error");b.html("");a?b.fadeOut("slow"):b.hide()},_showFolderError:function(a){var b=
this.$errorContainer;if(a){var c=this.msgFoldersNotAllowed.replace(/\{n}/g,a);this._addError(c);e.addCss(this.$container,"has-error");b.fadeIn(800);this._raise("filefoldererror",[a,c])}},_showUploadError:function(a,b,c){var d=this.$errorContainer;c=c||"fileuploaderror";var f=b&&b.id?'<li data-file-id="'+b.id+'">'+a+"</li>":"<li>"+a+"</li>";0===d.find("ul").length?this._addError("<ul>"+f+"</ul>"):d.find("ul").append(f);d.fadeIn(800);this._raise(c,[b,a]);this.$container.removeClass("file-input-new");
e.addCss(this.$container,"has-error");return!0},_showError:function(a,b,c){var d=this.$errorContainer;c=c||"fileerror";b=b||{};b.reader=this.reader;this._addError(a);d.fadeIn(800);this._raise(c,[b,a]);this.isUploadable||this._clearFileInput();this.$container.removeClass("file-input-new");e.addCss(this.$container,"has-error");this.$btnUpload.attr("disabled",!0);return!0},_noFilesError:function(a){var b=1<this.minFileCount?this.filePlural:this.fileSingle;b=this.msgFilesTooLess.replace("{n}",this.minFileCount).replace("{files}",
b);var c=this.$errorContainer;this._addError(b);this.isError=!0;this._updateFileDetails(0);c.fadeIn(800);this._raise("fileerror",[a,b]);this._clearFileInput();e.addCss(this.$container,"has-error")},_parseError:function(a,b,c,d){c=g.trim(c+"");var f="."===c.slice(-1)?"":".";b=void 0!==b.responseJSON&&void 0!==b.responseJSON.error?b.responseJSON.error:b.responseText;this.cancelling&&this.msgUploadAborted&&(c=this.msgUploadAborted);this.showAjaxErrorDetails&&b?(b=g.trim(b.replace(/\n\s*\n/g,"\n")),b=
0<b.length?"<pre>"+b+"</pre>":"",c+=f+b):c+=f;c===f&&(c=this.msgAjaxError.replace("{operation}",a));this.cancelling=!1;return d?"<b>"+d+": </b>"+c:c},_parseFileType:function(a){var b,c=this.allowedPreviewTypes;for(b=0;b<c.length;b++){var d=c[b];var f=this.fileTypeSettings[d];f=f(a.type,a.name)?d:"";if(!e.isEmpty(f))return f}return"other"},_getPreviewIcon:function(a){var b=this,c=null;if(a&&-1<a.indexOf(".")){var d=a.split(".").pop();b.previewFileIconSettings&&b.previewFileIconSettings[d]&&(c=b.previewFileIconSettings[d]);
b.previewFileExtSettings&&g.each(b.previewFileExtSettings,function(a,e){b.previewFileIconSettings[a]&&e(d)&&(c=b.previewFileIconSettings[a])})}return c},_parseFilePreviewIcon:function(a,b){var c=this._getPreviewIcon(b)||this.previewFileIcon;-1<a.indexOf("{previewFileIcon}")&&(a=a.replace(/\{previewFileIconClass}/g,this.previewFileIconClass).replace(/\{previewFileIcon}/g,c));return a},_raise:function(a,b){var c=g.Event(a);void 0!==b?this.$element.trigger(c,b):this.$element.trigger(c);if(c.isDefaultPrevented()||
!1===c.result)return!1;switch(a){case "filebatchuploadcomplete":case "filebatchuploadsuccess":case "fileuploaded":case "fileclear":case "filecleared":case "filereset":case "fileerror":case "filefoldererror":case "fileuploaderror":case "filebatchuploaderror":case "filedeleteerror":case "filecustomerror":case "filesuccessremove":break;default:this.ajaxAborted=c.result}return!0},_listenFullScreen:function(a){var b=this.$modal;if(b&&b.length){var c=b&&b.find(".btn-fullscreen");var d=b&&b.find(".btn-borderless");
c.length&&d.length&&(c.removeClass("active").attr("aria-pressed","false"),d.removeClass("active").attr("aria-pressed","false"),a?c.addClass("active").attr("aria-pressed","true"):d.addClass("active").attr("aria-pressed","true"),b.hasClass("file-zoom-fullscreen")?this._maximizeZoomDialog():a?this._maximizeZoomDialog():d.removeClass("active").attr("aria-pressed","false"))}},_listen:function(){var a=this,b=a.$form,c=a.$container;a._handler(a.$element,"change",g.proxy(a._change,a));a.showBrowse&&a._handler(a.$btnFile,
"click",g.proxy(a._browse,a));a._handler(c.find(".fileinput-remove:not([disabled])"),"click",g.proxy(a.clear,a));a._handler(c.find(".fileinput-cancel"),"click",g.proxy(a.cancel,a));a._initDragDrop();a._handler(b,"reset",g.proxy(a.reset,a));a.isUploadable||a._handler(b,"submit",g.proxy(a._submitForm,a));a._handler(a.$container.find(".fileinput-upload"),"click",g.proxy(a._uploadClick,a));a._handler(g(window),"resize",function(){a._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)});
a._handler(g(document),"webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",function(){a._listenFullScreen(e.checkFullScreen())});a._initClickable()},_initClickable:function(){var a=this;if(a.isClickable){var b=a.isUploadable?a.$dropZone:a.$preview.find(".file-default-preview");e.addCss(b,"clickable");b.attr("tabindex",-1);a._handler(b,"click",function(c){c=g(c.target);if(!c.parents(".file-preview-thumbnails").length||c.parents(".file-default-preview").length)a.$element.trigger("click"),
b.blur()})}},_initDragDrop:function(){var a=this.$dropZone;this.isUploadable&&this.dropZoneEnabled&&this.showPreview&&(this._handler(a,"dragenter dragover",g.proxy(this._zoneDragEnter,this)),this._handler(a,"dragleave",g.proxy(this._zoneDragLeave,this)),this._handler(a,"drop",g.proxy(this._zoneDrop,this)),this._handler(g(document),"dragenter dragover drop",this._zoneDragDropInit))},_zoneDragDropInit:function(a){a.stopPropagation();a.preventDefault()},_zoneDragEnter:function(a){var b=-1<g.inArray("Files",
a.originalEvent.dataTransfer.types);this._zoneDragDropInit(a);this.isDisabled||!b?(a.originalEvent.dataTransfer.effectAllowed="none",a.originalEvent.dataTransfer.dropEffect="none"):e.addCss(this.$dropZone,"file-highlighted")},_zoneDragLeave:function(a){this._zoneDragDropInit(a);this.isDisabled||this.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(a){a.preventDefault();this.isDisabled||e.isEmpty(a.originalEvent.dataTransfer.files)||(this._change(a,"dragdrop"),this.$dropZone.removeClass("file-highlighted"))},
_uploadClick:function(a){var b=this.$container.find(".fileinput-upload"),c=!b.hasClass("disabled")&&e.isEmpty(b.attr("disabled"));a&&a.isDefaultPrevented()||(this.isUploadable?(a.preventDefault(),c&&this.upload()):c&&"submit"!==b.attr("type")&&(b=b.closest("form"),b.length&&b.trigger("submit"),a.preventDefault()))},_submitForm:function(){var a=this.$element.get(0).files;return a&&0<this.minFileCount&&this._getFileCount(a.length)<this.minFileCount?(this._noFilesError({}),!1):!this._abort({})},_clearPreview:function(){var a=
this.$preview;(this.showUploadedThumbs?a.find(e.FRAMES+":not(.file-preview-success)"):a.find(e.FRAMES)).each(function(){var b=g(this);b.remove();e.cleanZoomCache(a.find("#zoom-"+b.attr("id")))});this.$preview.find(e.FRAMES).length&&this.showPreview||this._resetUpload();this._validateDefaultPreview()},_initSortable:function(){var a=this,b=a.$preview;var c="."+e.SORT_CSS;window.KvSortable&&0!==b.find(c).length&&(c={handle:".drag-handle-init",dataIdAttr:"data-preview-id",draggable:c,onSort:function(b){var c=
b.oldIndex,d=b.newIndex;a.initialPreview=e.moveArray(a.initialPreview,c,d);a.initialPreviewConfig=e.moveArray(a.initialPreviewConfig,c,d);a.previewCache.init();for(var k=0;k<a.initialPreviewConfig.length;k++)if(null!==a.initialPreviewConfig[k]){var m=a.initialPreviewConfig[k].key;m=g(".kv-file-remove[data-key='"+m+"']").closest(e.FRAMES);m.attr("data-fileindex","init_"+k).data("fileindex","init_"+k)}a._raise("filesorted",{previewId:g(b.item).attr("id"),oldIndex:c,newIndex:d,stack:a.initialPreviewConfig})}},
b.data("kvsortable")&&b.kvsortable("destroy"),g.extend(!0,c,a.fileActionSettings.dragSettings),b.kvsortable(c))},_initPreview:function(a){var b=this.initialCaption||"";if(this.previewCache.count()){var c=this.previewCache.out();b=a&&this.initialCaption?this.initialCaption:c.caption;this.$preview.html(c.content);this._setInitThumbAttr();this._setCaption(b);this._initSortable();e.isEmpty(c.content)||this.$container.removeClass("file-input-new")}else this._clearPreview(),a?this._setCaption(b):this._initCaption()},
_getZoomButton:function(a){var b=this.previewZoomButtonIcons[a],c=this.previewZoomButtonClasses[a],d=' title="'+(this.previewZoomButtonTitles[a]||"")+'" '+("close"===a?' data-dismiss="modal" aria-hidden="true"':"");if("fullscreen"===a||"borderless"===a||"toggleheader"===a)d+=' data-toggle="button" aria-pressed="false" autocomplete="off"';return'<button type="button" class="'+c+" btn-"+a+'"'+d+">"+b+"</button>"},_getModalContent:function(){return this._getLayoutTemplate("modal").replace(/\{heading}/g,
this.msgZoomModalHeading).replace(/\{prev}/g,this._getZoomButton("prev")).replace(/\{next}/g,this._getZoomButton("next")).replace(/\{toggleheader}/g,this._getZoomButton("toggleheader")).replace(/\{fullscreen}/g,this._getZoomButton("fullscreen")).replace(/\{borderless}/g,this._getZoomButton("borderless")).replace(/\{close}/g,this._getZoomButton("close"))},_listenModalEvent:function(a){var b=this,c=b.$modal;c.on(a+".bs.modal",function(d){var f=c.find(".btn-fullscreen"),h=c.find(".btn-borderless");b._raise("filezoom"+
a,{sourceEvent:d,previewId:c.data("previewId"),modal:c});"shown"===a&&(h.removeClass("active").attr("aria-pressed","false"),f.removeClass("active").attr("aria-pressed","false"),c.hasClass("file-zoom-fullscreen")&&(b._maximizeZoomDialog(),e.checkFullScreen()?f.addClass("active").attr("aria-pressed","true"):h.addClass("active").attr("aria-pressed","true")))})},_initZoom:function(){var a=this;var b=a._getLayoutTemplate("modalMain");a.showPreview&&(a.$modal=g("#"+e.MODAL_ID),a.$modal&&a.$modal.length||
(b=g(document.createElement("div")).html(b).insertAfter(a.$container),a.$modal=g("#"+e.MODAL_ID).insertBefore(b),b.remove()),e.initModal(a.$modal),a.$modal.html(a._getModalContent()),g.each(e.MODAL_EVENTS,function(b,d){a._listenModalEvent(d)}))},_initZoomButtons:function(){var a=this.$modal.data("previewId")||"";var b=this.$preview.find(e.FRAMES).toArray();var c=b.length,d=this.$modal.find(".btn-prev"),f=this.$modal.find(".btn-next");if(2>b.length)d.hide(),f.hide();else if(d.show(),f.show(),c){var h=
g(b[0]);b=g(b[c-1]);d.removeAttr("disabled");f.removeAttr("disabled");h.length&&h.attr("id")===a&&d.attr("disabled",!0);b.length&&b.attr("id")===a&&f.attr("disabled",!0)}},_maximizeZoomDialog:function(){var a=this.$modal,b=a.find(".modal-header:visible"),c=a.find(".modal-footer:visible"),d=a.find(".modal-body"),f=g(window).height();a.addClass("file-zoom-fullscreen");b&&b.length&&(f-=b.outerHeight(!0));c&&c.length&&(f-=c.outerHeight(!0));d&&d.length&&(b=d.outerHeight(!0)-d.height(),f-=b);a.find(".kv-zoom-body").height(f)},
_resizeZoomDialog:function(a){var b=this.$modal,c=b.find(".btn-fullscreen"),d=b.find(".btn-borderless");if(b.hasClass("file-zoom-fullscreen"))(e.toggleFullScreen(!1),a)?c.hasClass("active")||(b.removeClass("file-zoom-fullscreen"),this._resizeZoomDialog(!0),d.hasClass("active")&&d.removeClass("active").attr("aria-pressed","false")):c.hasClass("active")?c.removeClass("active").attr("aria-pressed","false"):(b.removeClass("file-zoom-fullscreen"),this.$modal.find(".kv-zoom-body").css("height",this.zoomModalHeight));
else{if(!a){this._maximizeZoomDialog();return}e.toggleFullScreen(!0)}b.focus()},_setZoomContent:function(a,b){var c=this,d=a.attr("id"),f=c.$modal,h=f.find(".btn-prev"),k=f.find(".btn-next"),m=f.find(".btn-fullscreen"),l=f.find(".btn-borderless"),r=f.find(".btn-toggleheader");var p=c.$preview.find("#zoom-"+d);var q=p.attr("data-template")||"generic";p=p.find(".kv-file-content");p=p.length?p.html():"";var w=a.data("caption")||"";var u=a.data("size")||"";w=w+" "+u;f.find(".kv-zoom-title").html(w);var v=
f.find(".kv-zoom-body");f.removeClass("kv-single-content");if(b){var Q=v.clone().insertAfter(v);v.html(p).hide();Q.fadeOut("fast",function(){v.fadeIn("fast");Q.remove()})}else v.html(p);if(q=c.previewZoomSettings[q]){var H=v.find(".kv-preview-data");e.addCss(H,"file-zoom-detail");g.each(q,function(a,b){H.css(a,b);(H.attr("width")&&"width"===a||H.attr("height")&&"height"===a)&&H.removeAttr(a)})}f.data("previewId",d);c._handler(h,"click",function(){c._zoomSlideShow("prev",d)});c._handler(k,"click",
function(){c._zoomSlideShow("next",d)});c._handler(m,"click",function(){c._resizeZoomDialog(!0)});c._handler(l,"click",function(){c._resizeZoomDialog(!1)});c._handler(r,"click",function(){var a=f.find(".modal-header"),b=f.find(".modal-body .floating-buttons"),d=a.find(".kv-zoom-actions"),e=function(b){var d=c.$modal.find(".kv-zoom-body"),e=c.zoomModalHeight;f.hasClass("file-zoom-fullscreen")&&(e=d.outerHeight(!0),b||(e-=a.outerHeight(!0)));d.css("height",b?e+b:e)};if(a.is(":visible")){var h=a.outerHeight(!0);
a.slideUp("slow",function(){d.find(".btn").appendTo(b);e(h)})}else b.find(".btn").appendTo(d),a.slideDown("slow",function(){e()});f.focus()});c._handler(f,"keydown",function(a){a=a.which||a.keyCode;37!==a||h.attr("disabled")||c._zoomSlideShow("prev",d);39!==a||k.attr("disabled")||c._zoomSlideShow("next",d)})},_zoomPreview:function(a){var b=this.$modal;if(!a.length)throw"Cannot zoom to detailed preview!";e.initModal(b);b.html(this._getModalContent());a=a.closest(e.FRAMES);this._setZoomContent(a);b.modal("show");
this._initZoomButtons()},_zoomSlideShow:function(a,b){var c=this.$modal.find(".kv-zoom-actions .btn-"+a);var d=this.$preview.find(e.FRAMES).toArray();var f=d.length;if(!c.attr("disabled")){for(c=0;c<f;c++)if(g(d[c]).attr("id")===b){var h="prev"===a?c-1:c+1;break}0>h||h>=f||!d[h]||(d=g(d[h]),d.length&&this._setZoomContent(d,!0),this._initZoomButtons(),this._raise("filezoom"+a,{previewId:b,modal:this.$modal}))}},_initZoomButton:function(){var a=this;a.$preview.find(".kv-file-zoom").each(function(){var b=
g(this);a._handler(b,"click",function(){a._zoomPreview(b)})})},_clearObjects:function(a){a.find("video audio").each(function(){this.pause();g(this).remove()});a.find("img object div").each(function(){g(this).remove()})},_clearFileInput:function(){var a=this.$element;this.fileInputCleared=!0;if(!e.isEmpty(a.val()))if(this.isIE9||this.isIE10){var b=a.closest("form");var c=g(document.createElement("form"));var d=g(document.createElement("div"));a.before(d);b.length?b.after(c):d.after(c);c.append(a).trigger("reset");
d.before(a).remove();c.remove()}else a.val("")},_resetUpload:function(){this.uploadCache={content:[],config:[],tags:[],append:!0};this.uploadCount=0;this.uploadStatus={};this.uploadLog=[];this.uploadAsyncCount=0;this.loadedImages=[];this.totalImagesCount=0;this.$btnUpload.removeAttr("disabled");this._setProgress(0);e.addCss(this.$progress,"hide");this._resetErrors(!1);this.ajaxAborted=!1;this.ajaxRequests=[];this._resetCanvas();this.cacheInitialPreview={};this.overwriteInitial&&(this.initialPreview=
[],this.initialPreviewConfig=[],this.initialPreviewThumbTags=[],this.previewCache.data={content:[],config:[],tags:[]})},_resetCanvas:function(){this.canvas&&this.imageCanvasContext&&this.imageCanvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)},_hasInitialPreview:function(){return!this.overwriteInitial&&this.previewCache.count()},_resetPreview:function(){if(this.previewCache.count()){var a=this.previewCache.out();this.$preview.html(a.content);this._setInitThumbAttr();a=this.initialCaption?
this.initialCaption:a.caption;this._setCaption(a)}else this._clearPreview(),this._initCaption();this.showPreview&&(this._initZoom(),this._initSortable())},_clearDefaultPreview:function(){this.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){this.showPreview&&!e.isEmpty(this.defaultPreviewContent)&&(this.$preview.html('<div class="file-default-preview">'+this.defaultPreviewContent+"</div>"),this.$container.removeClass("file-input-new"),this._initClickable())},_resetPreviewThumbs:function(a){a?
(this._clearPreview(),this.clearStack()):this._hasInitialPreview()?(a=this.previewCache.out(),this.$preview.html(a.content),this._setInitThumbAttr(),this._setCaption(a.caption),this._initPreviewActions()):this._clearPreview()},_getLayoutTemplate:function(a){a=this.layoutTemplates[a];return e.isEmpty(this.customLayoutTags)?a:e.replaceTags(a,this.customLayoutTags)},_getPreviewTemplate:function(a){a=this.previewTemplates[a];return e.isEmpty(this.customPreviewTags)?a:e.replaceTags(a,this.customPreviewTags)},
_getOutData:function(a,b,c){a=a||{};b=b||{};c=c||this.filestack.slice(0)||{};return{form:this.formdata,files:c,filenames:this.filenames,filescount:this.getFilesCount(),extra:this._getExtraData(),response:b,reader:this.reader,jqXHR:a}},_getMsgSelected:function(a){var b=1===a?this.fileSingle:this.filePlural;return 0<a?this.msgSelected.replace("{n}",a).replace("{files}",b):this.msgNoFilesSelected},_getThumbs:function(a){return this.$preview.find(e.FRAMES+":not(.file-preview-initial)"+(a||""))},_getExtraData:function(a,
b){var c=this.uploadExtraData;"function"===typeof this.uploadExtraData&&(c=this.uploadExtraData(a,b));return c},_initXhr:function(a,b,c){var d=this;a.upload&&a.upload.addEventListener("progress",function(a){var f=0,e=a.total,g=a.loaded||a.position;a.lengthComputable&&(f=Math.floor(g/e*100));b?d._setAsyncUploadStatus(b,f,c):d._setProgress(f)},!1);return a},_ajaxSubmit:function(a,b,c,d,f,e){var h=this;h._raise("filepreajax",[f,e])&&(h._uploadExtra(f,e),a=g.extend(!0,{},{xhr:function(){var a=g.ajaxSettings.xhr();
return h._initXhr(a,f,h.getFileStack().length)},url:h.uploadUrl,type:"POST",dataType:"json",data:h.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:a,success:b,complete:c,error:d},h.ajaxSettings),h.ajaxRequests.push(g.ajax(a)))},_mergeArray:function(a,b){var c=e.cleanArray(this[a]),d=e.cleanArray(b);this[a]=c.concat(d)},_initUploadSuccess:function(a,b,c){var d=this;if(d.showPreview&&"object"===typeof a&&!g.isEmptyObject(a)&&void 0!==a.initialPreview&&0<a.initialPreview.length){d.hasInitData=
!0;var f=a.initialPreview||[];var h=a.initialPreviewConfig||[];var k=a.initialPreviewThumbTags||[];a=void 0===a.append||a.append?!0:!1;0<f.length&&!e.isArray(f)&&(f=f.split(d.initialPreviewDelimiter));d._mergeArray("initialPreview",f);d._mergeArray("initialPreviewConfig",h);d._mergeArray("initialPreviewThumbTags",k);if(void 0!==b)if(c)c=b.attr("data-fileindex"),d.uploadCache.content[c]=f[0],d.uploadCache.config[c]=h[0]||[],d.uploadCache.tags[c]=k[0]||[],d.uploadCache.append=a;else{f=d.previewCache.add(f,
h[0],k[0],a);f=d.previewCache.get(f,!1);var m=g(document.createElement("div")).html(f).hide().insertAfter(b);(f=m.find(".kv-zoom-cache"))&&f.length&&f.insertAfter(b);b.fadeOut("slow",function(){var a=m.find(".file-preview-frame");a&&a.length&&a.insertBefore(b).fadeIn("slow").css("display:inline-block");d._initPreviewActions();d._clearFileInput();e.cleanZoomCache(d.$preview.find("#zoom-"+b.attr("id")));b.remove();m.remove();d._initSortable()})}else d.previewCache.set(f,h,k,a),d._initPreview(),d._initPreviewActions()}},
_initSuccessThumbs:function(){var a=this;a.showPreview&&a._getThumbs(e.FRAMES+".file-preview-success").each(function(){var b=g(this),c=a.$preview,d=b.find(".kv-file-remove");d.removeAttr("disabled");a._handler(d,"click",function(){var d=b.attr("id"),h=a._raise("filesuccessremove",[d,b.data("fileindex")]);e.cleanMemory(b);!1!==h&&b.fadeOut("slow",function(){e.cleanZoomCache(c.find("#zoom-"+d));b.remove();c.find(e.FRAMES).length||a.reset()})})})},_checkAsyncComplete:function(){var a;for(a=0;a<this.filestack.length;a++)if(this.filestack[a]){var b=
this.previewInitId+"-"+a;if(-1===g.inArray(b,this.uploadLog))return!1}return this.uploadAsyncCount===this.uploadLog.length},_uploadExtra:function(a,b){var c=this,d=c._getExtraData(a,b);0!==d.length&&g.each(d,function(a,b){c.formdata.append(a,b)})},_uploadSingle:function(a,b,c){var d=this,f=d.getFileStack().length,h=new FormData,k,m=d.previewInitId+"-"+a,l=0<d.filestack.length||!g.isEmptyObject(d.uploadExtraData),r=g("#"+m).find(".file-thumb-progress"),p={id:m,index:a};d.formdata=h;if(d.showPreview){var q=
g("#"+m+":not(.file-preview-initial)");var w=q.find(".kv-file-upload");var u=q.find(".kv-file-remove");r.removeClass("hide")}if(!(0===f||!l||w&&w.hasClass("disabled")||d._abort(p))){var v=function(a,b){d.updateStack(a,void 0);d.uploadLog.push(b);d._checkAsyncComplete()&&(d.fileBatchCompleted=!0)};var Q=function(){var a=d.uploadCache,b,c,f,h=0,g=d.cacheInitialPreview;d.fileBatchCompleted&&(g&&g.content&&(h=g.content.length),setTimeout(function(){if(d.showPreview){d.previewCache.set(a.content,a.config,
a.tags,a.append);if(h){for(c=0;c<a.content.length;c++)f=c+h,g.content[f]=a.content[c],g.config.length&&(g.config[f]=a.config[c]),g.tags.length&&(g.tags[f]=a.tags[c]);d.initialPreview=e.cleanArray(g.content);d.initialPreviewConfig=e.cleanArray(g.config);d.initialPreviewThumbTags=e.cleanArray(g.tags)}else d.initialPreview=a.content,d.initialPreviewConfig=a.config,d.initialPreviewThumbTags=a.tags;d.cacheInitialPreview={};d.hasInitData&&(d._initPreview(),d._initPreviewActions())}d.unlock();d._clearFileInput();
b=d.$preview.find(".file-preview-initial");d.uploadAsync&&b.length&&(e.addCss(b,e.SORT_CSS),d._initSortable());d._raise("filebatchuploadcomplete",[d.filestack,d._getExtraData()]);d.uploadCount=0;d.uploadStatus={};d.uploadLog=[];d._setProgress(101)},100))};h.append(d.uploadFileAttr,b[a],d.filenames[a]);h.append("file_id",a);d._ajaxSubmit(function(b){k=d._getOutData(b);d.fileBatchCompleted=!1;d.showPreview&&(q.hasClass("file-preview-success")||(d._setThumbStatus(q,"Loading"),e.addCss(q,"file-uploading")),
w.attr("disabled",!0),u.attr("disabled",!0));c||d.lock();d._raise("filepreupload",[k,m,a]);g.extend(!0,p,k);d._abort(p)&&(b.abort(),d._setProgressCancelled())},function(b,f,h){var l=d.showPreview&&q.attr("id")?q.attr("id"):m;k=d._getOutData(h,b);g.extend(!0,p,k);setTimeout(function(){e.isEmpty(b)||e.isEmpty(b.error)?(d.showPreview&&(d._setThumbStatus(q,"Success"),w.hide(),d._initUploadSuccess(b,q,c),d._setProgress(101,r)),d._raise("fileuploaded",[k,l,a]),c?v(a,l):d.updateStack(a,void 0)):(d._showUploadError(b.error,
p),d._setPreviewError(q,a),c&&v(a,l))},100)},function(){setTimeout(function(){d.showPreview&&(w.removeAttr("disabled"),u.removeAttr("disabled"),q.removeClass("file-uploading"));c?Q():(d.unlock(!1),d._clearFileInput());d._initSuccessThumbs()},100)},function(f,e,h){var k=d.ajaxOperations.uploadThumb,l=d._parseError(k,f,h,c?b[a].name:null);setTimeout(function(){c&&v(a,m);d.uploadStatus[m]=100;d._setPreviewError(q,a);g.extend(!0,p,d._getOutData(f));d._setProgress(101,r,d.msgAjaxProgressError.replace("{operation}",
k));d._showUploadError(l,p)},100)},m,a)}},_uploadBatch:function(){var a=this,b=a.filestack,c=b.length,d={},f=0<a.filestack.length||!g.isEmptyObject(a.uploadExtraData);a.formdata=new FormData;if(0!==c&&f&&!a._abort(d)){var h=function(){g.each(b,function(b){a.updateStack(b,void 0)});a._clearFileInput()};g.each(b,function(c,d){e.isEmpty(b[c])||a.formdata.append(a.uploadFileAttr,d,a.filenames[c])});a._ajaxSubmit(function(b){a.lock();var c=a._getOutData(b);a.showPreview&&a._getThumbs().each(function(){var b=
g(this),c=b.find(".kv-file-upload"),d=b.find(".kv-file-remove");b.hasClass("file-preview-success")||(a._setThumbStatus(b,"Loading"),e.addCss(b,"file-uploading"));c.attr("disabled",!0);d.attr("disabled",!0)});a._raise("filebatchpreupload",[c]);a._abort(c)&&(b.abort(),a._setProgressCancelled())},function(b,c,d){c=a._getOutData(d,b);d=a._getThumbs(":not(.file-preview-error)");var f=0,k=e.isEmpty(b)||e.isEmpty(b.errorkeys)?[]:b.errorkeys;e.isEmpty(b)||e.isEmpty(b.error)?(a._raise("filebatchuploadsuccess",
[c]),h(),a.showPreview?(d.each(function(){var b=g(this),c=b.find(".kv-file-upload");b.find(".kv-file-upload").hide();a._setThumbStatus(b,"Success");b.removeClass("file-uploading");c.removeAttr("disabled")}),a._initUploadSuccess(b)):a.reset(),a._setProgress(101)):(a.showPreview&&(d.each(function(){var b=g(this),c=b.find(".kv-file-remove"),d=b.find(".kv-file-upload");b.removeClass("file-uploading");d.removeAttr("disabled");c.removeAttr("disabled");0===k.length?a._setPreviewError(b):(-1!==g.inArray(f,
k)?a._setPreviewError(b):(b.find(".kv-file-upload").hide(),a._setThumbStatus(b,"Success"),a.updateStack(f,void 0)),f++)}),a._initUploadSuccess(b)),a._showUploadError(b.error,c,"filebatchuploaderror"))},function(){a.unlock();a._initSuccessThumbs();a._clearFileInput();a._raise("filebatchuploadcomplete",[a.filestack,a._getExtraData()])},function(b,d,f){d=a._getOutData(b);var e=a.ajaxOperations.uploadBatch;b=a._parseError(e,b,f);a._showUploadError(b,d,"filebatchuploaderror");a.uploadFileCount=c-1;a.showPreview&&
(a._getThumbs().each(function(){var b=g(this),c=b.attr("data-fileindex");b.removeClass("file-uploading");void 0!==a.filestack[c]&&a._setPreviewError(b)}),a._getThumbs().removeClass("file-uploading"),a._getThumbs(" .kv-file-upload").removeAttr("disabled"),a._getThumbs(" .kv-file-delete").removeAttr("disabled"),a._setProgress(101,a.$progress,a.msgAjaxProgressError.replace("{operation}",e)))})}},_uploadExtraOnly:function(){var a=this,b={};a.formdata=new FormData;a._abort(b)||a._ajaxSubmit(function(c){a.lock();
var d=a._getOutData(c);a._raise("filebatchpreupload",[d]);a._setProgress(50);b.data=d;b.xhr=c;a._abort(b)&&(c.abort(),a._setProgressCancelled())},function(b,d,f){d=a._getOutData(f,b);e.isEmpty(b)||e.isEmpty(b.error)?(a._raise("filebatchuploadsuccess",[d]),a._clearFileInput(),a._initUploadSuccess(b),a._setProgress(101)):a._showUploadError(b.error,d,"filebatchuploaderror")},function(){a.unlock();a._clearFileInput();a._raise("filebatchuploadcomplete",[a.filestack,a._getExtraData()])},function(c,d,f){d=
a._getOutData(c);var e=a.ajaxOperations.uploadExtra;c=a._parseError(e,c,f);b.data=d;a._showUploadError(c,d,"filebatchuploaderror");a._setProgress(101,a.$progress,a.msgAjaxProgressError.replace("{operation}",e))})},_deleteFileIndex:function(a){var b=a.attr("data-fileindex");"init_"===b.substring(0,5)&&(b=parseInt(b.replace("init_","")),this.initialPreview=e.spliceArray(this.initialPreview,b),this.initialPreviewConfig=e.spliceArray(this.initialPreviewConfig,b),this.initialPreviewThumbTags=e.spliceArray(this.initialPreviewThumbTags,
b),this.$preview.find(e.FRAMES).each(function(){var a=g(this),d=a.attr("data-fileindex");"init_"===d.substring(0,5)&&(d=parseInt(d.replace("init_","")),d>b&&(d--,a.attr("data-fileindex","init_"+d)))}),this.uploadAsync&&(this.cacheInitialPreview=this.getPreview()))},_initFileActions:function(){var a=this,b=a.$preview;a.showPreview&&(a._initZoomButton(),b.find(e.FRAMES+" .kv-file-remove").each(function(){var c=g(this),d=c.closest(e.FRAMES),f,h=d.attr("id"),k=d.attr("data-fileindex"),m,l,r;a._handler(c,
"click",function(){r=a._raise("filepreremove",[h,k]);if(!1===r||!a._validateMinCount())return!1;f=d.hasClass("file-preview-error");e.cleanMemory(d);d.fadeOut("slow",function(){e.cleanZoomCache(b.find("#zoom-"+h));a.updateStack(k,void 0);a._clearObjects(d);d.remove();h&&f&&a.$errorContainer.find('li[data-file-id="'+h+'"]').fadeOut("fast",function(){g(this).remove();a._errorsExist()||a._resetErrors()});a._clearFileInput();var c=a.getFileStack(!0),q=a.previewCache.count(),r=c.length,u=a.showPreview&&
b.find(e.FRAMES).length;0!==r||0!==q||u?(m=q+r,l=1<m?a._getMsgSelected(m):c[0]?a._getFileNames()[0]:"",a._setCaption(l)):a.reset();a._raise("fileremoved",[h,k])})})}),a.$preview.find(e.FRAMES+" .kv-file-upload").each(function(){var b=g(this);a._handler(b,"click",function(){var c=b.closest(e.FRAMES),f=c.attr("data-fileindex");c.hasClass("file-preview-error")||a._uploadSingle(f,a.filestack,!1)})}))},_initPreviewActions:function(){var a=this,b=a.$preview,c=a.deleteExtraData||{},d=e.FRAMES+" .kv-file-remove",
f=function(){var c=a.isUploadable?a.previewCache.count():a.$element.get(0).files.length;0!==b.find(d).length||c||(a.reset(),a.initialCaption="")};a._initZoomButton();b.find(d).each(function(){var d=g(this),k=d.data("url")||a.deleteUrl,m=d.data("key");if(!e.isEmpty(k)&&void 0!==m){var l=d.closest(e.FRAMES),r=a.previewCache.data,p=l.data("fileindex");p=parseInt(p.replace("init_",""));r=e.isEmpty(r.config)&&e.isEmpty(r.config[p])?null:r.config[p];var q=e.isEmpty(r)||e.isEmpty(r.extra)?c:r.extra;"function"===
typeof q&&(q=q());var w={id:d.attr("id"),key:m,extra:q};var u=g.extend(!0,{},{url:k,type:"POST",dataType:"json",data:g.extend(!0,{},{key:m},q),beforeSend:function(b){a.ajaxAborted=!1;a._raise("filepredelete",[m,b,q]);a.ajaxAborted?b.abort():(e.addCss(l,"file-uploading"),e.addCss(d,"disabled"))},success:function(c,h,g){if(e.isEmpty(c)||e.isEmpty(c.error)){a.previewCache.init();p=parseInt(l.data("fileindex").replace("init_",""));a.previewCache.unset(p);var k=a.previewCache.count();c=0<k?a._getMsgSelected(k):
"";a._deleteFileIndex(l);a._setCaption(c);a._raise("filedeleted",[m,g,q]);l.removeClass("file-uploading").addClass("file-deleted");l.fadeOut("slow",function(){e.cleanZoomCache(b.find("#zoom-"+l.attr("id")));a._clearObjects(l);l.remove();f();k||0!==a.getFileStack().length||(a._setCaption(""),a.reset())})}else w.jqXHR=g,w.response=c,a._showError(c.error,w,"filedeleteerror"),l.removeClass("file-uploading"),d.removeClass("disabled"),f()},error:function(b,c,d){c=a._parseError(a.ajaxOperations.deleteThumb,
b,d);w.jqXHR=b;w.response={};a._showError(c,w,"filedeleteerror");l.removeClass("file-uploading");f()}},a.ajaxDeleteSettings);a._handler(d,"click",function(){if(!a._validateMinCount())return!1;g.ajax(u)})}})},_hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},_showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},_getSize:function(a){var b=parseFloat(a),c=this.fileSizeGetter;if(!g.isNumeric(a)||!g.isNumeric(b))return"";
"function"===typeof c?b=c(b):0===b?b="0.00 B":(a=Math.floor(Math.log(b)/Math.log(1024)),c="B KB MB GB TB PB EB ZB YB".split(" "),b=1*(b/Math.pow(1024,a)).toFixed(2)+" "+c[a]);return this._getLayoutTemplate("size").replace("{sizeText}",b)},_generatePreviewTemplate:function(a,b,c,d,f,h,g,m,l,r,p){var k=this,w=k.slug(c),u="",v=k.previewSettings[a]||k.defaults.previewSettings[a],z=v&&v.width?v.width:"",H=v&&v.height?v.height:"",n=l||k._renderFileFooter(w,g,e.isEmpty(z)?"auto":z,h);h=(g=k._getPreviewIcon(c))&&
k.preferIconicPreview;g=g&&k.preferIconicZoomPreview;l=function(b,h,g,l){var t=g?"zoom-"+f:f,q=k._getPreviewTemplate(b);l=(m||"")+" "+l;k.frameClass&&(l=k.frameClass+" "+l);g&&(l=l.replace(" "+e.SORT_CSS,""));q=k._parseFilePreviewIcon(q,c);"text"===b&&(h=e.htmlEncode(h));return q.replace(/\{previewId}/g,t).replace(/\{caption}/g,w).replace(/\{frameClass}/g,l).replace(/\{type}/g,d).replace(/\{fileindex}/g,r).replace(/\{width}/g,z).replace(/\{height}/g,H).replace(/\{footer}/g,n).replace(/\{data}/g,h).replace(/\{template}/g,
p||a)};r=r||f.slice(f.lastIndexOf("-")+1);k.fileActionSettings.showZoom&&(u=l(g?"other":a,b,!0,"kv-zoom-thumb"));u="\n"+k._getLayoutTemplate("zoomCache").replace("{zoomContent}",u);return l(h?"other":a,b,!1,"kv-preview-thumb")+u},_previewDefault:function(a,b,c){var d=this.$preview;if(this.showPreview){var f=a?a.name:"",h=a?a.type:"",k=a.size||0,m=this.slug(f),l=!0===c&&!this.isUploadable;a=e.objUrl.createObjectURL(a);this._clearDefaultPreview();f=this._generatePreviewTemplate("other",a,f,h,b,l,k);
d.append("\n"+f);this._setThumbAttr(b,m,k);!0===c&&this.isUploadable&&this._setThumbStatus(g("#"+b),"Error")}},_previewFile:function(a,b,c,d,f){if(this.showPreview){var e=this._parseFileType(b),g=b?b.name:"";a=this.slug(g);var m=this.allowedPreviewTypes,l=this.allowedPreviewMimeTypes,r=this.$preview,p=m&&0<=m.indexOf(e);m=b.size||0;c="text"===e||"html"===e||"image"===e?c.target.result:f;f=l&&-1!==l.indexOf(b.type);"html"===e&&this.purifyHtml&&window.DOMPurify&&(c=window.DOMPurify.sanitize(c));p||
f?(e=this._generatePreviewTemplate(e,c,g,b.type,d,!1,m),this._clearDefaultPreview(),r.append("\n"+e),this._validateImage(d,a,b.type)):this._previewDefault(b,d);this._setThumbAttr(d,a,m);this._initSortable()}},_setThumbAttr:function(a,b,c){a=g("#"+a);a.length&&(c=c&&0<c?this._getSize(c):"",a.data({caption:b,size:c}))},_setInitThumbAttr:function(){var a=this.previewCache.data,b=this.previewCache.count(!0);if(0!==b)for(var c=0;c<b;c++){var d=a.config[c];var f=this.previewInitId+"-init_"+c;var h=e.ifSet("caption",
d,e.ifSet("filename",d));d=e.ifSet("size",d);this._setThumbAttr(f,h,d)}},_slugDefault:function(a){return e.isEmpty(a)?"":String(a).replace(/[\-\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_readFiles:function(a){this.reader=new FileReader;var b=this,c=b.$element,d=b.$preview,f=b.reader,h=b.$previewContainer,k=b.$previewStatus,m=b.msgLoading,l=b.msgProgress,r=b.previewInitId,p=a.length,q=b.fileTypeSettings,w=b.filestack.length,u=b.allowedFileTypes,v=u?u.length:0,z=b.allowedFileExtensions,H=e.isEmpty(z)?
"":z.join(", "),n=b.maxFilePreviewSize&&parseFloat(b.maxFilePreviewSize),K=d.length&&(!n||isNaN(n)),x=function(c,d,f,e){var h=g.extend(!0,{},b._getOutData({},{},a),{id:f,index:e}),k={id:f,index:e,file:d,files:a};b._previewDefault(d,f,!0);b.isUploadable&&(b.addToStack(void 0),setTimeout(function(){C(e+1)},100));b._initFileActions();b.removeFromPreviewOnError&&g("#"+f).remove();return b.isUploadable?b._showUploadError(c,h):b._showError(c,k)};b.loadedImages=[];b.totalImagesCount=0;g.each(a,function(a,
c){var d=b.fileTypeSettings.image;d&&d(c.type)&&b.totalImagesCount++});var C=function(g){e.isEmpty(c.attr("multiple"))&&(p=1);if(g>=p)b.isUploadable&&0<b.filestack.length?b._raise("filebatchselected",[b.getFileStack()]):b._raise("filebatchselected",[a]),h.removeClass("file-thumb-loading"),k.html("");else{var t=r+"-"+(w+g),y=a[g],A,I=y.name?b.slug(y.name):"";var N=(y.size||0)/1E3;var O="",Q=e.objUrl.createObjectURL(y);var L=0;var J="";if(0<v)for(A=0;A<v;A++){var D=u[A];D=b.msgFileTypes[D]||D;J+=0===
A?D:", "+D}if(!1===I)C(g+1);else if(0===I.length){var G=b.msgInvalidFileName.replace("{name}",e.htmlEncode(y.name));b.isError=x(G,y,t,g)}else if(e.isEmpty(z)||(O=new RegExp("\\.("+z.join("|")+")$","i")),A=N.toFixed(2),0<b.maxFileSize&&N>b.maxFileSize)G=b.msgSizeTooLarge.replace("{name}",I).replace("{size}",A).replace("{maxSize}",b.maxFileSize),b.isError=x(G,y,t,g);else if(null!==b.minFileSize&&N<=e.getNum(b.minFileSize))G=b.msgSizeTooSmall.replace("{name}",I).replace("{size}",A).replace("{minSize}",
b.minFileSize),b.isError=x(G,y,t,g);else{if(!e.isEmpty(u)&&e.isArray(u)){for(A=0;A<u.length;A+=1)D=u[A],D=q[D],L+=D&&"function"===typeof D?D(y.type,y.name)?1:0:0;if(0===L){G=b.msgInvalidFileType.replace("{name}",I).replace("{types}",J);b.isError=x(G,y,t,g);return}}if(0===L&&!e.isEmpty(z)&&e.isArray(z)&&!e.isEmpty(O)&&(O=e.compare(I,O),L+=e.isEmpty(O)?0:O.length,0===L)){G=b.msgInvalidFileExtension.replace("{name}",I).replace("{extensions}",H);b.isError=x(G,y,t,g);return}b.showPreview?!K&&N>n?(b.addToStack(y),
h.addClass("file-thumb-loading"),b._previewDefault(y,t),b._initFileActions(),b._updateFileDetails(p),C(g+1)):(d.length&&void 0!==FileReader?(k.html(m.replace("{index}",g+1).replace("{files}",p)),h.addClass("file-thumb-loading"),f.onerror=function(a){b._errorHandler(a,I)},f.onload=function(a){b._previewFile(g,y,a,t,Q);b._initFileActions()},f.onloadend=function(){G=l.replace("{index}",g+1).replace("{files}",p).replace("{percent}",50).replace("{name}",I);setTimeout(function(){k.html(G);b._updateFileDetails(p);
C(g+1)},100);b._raise("fileloaded",[y,t,g,f])},f.onprogress=function(a){a.lengthComputable&&(a=Math.ceil(a.loaded/a.total*100),G=l.replace("{index}",g+1).replace("{files}",p).replace("{percent}",a).replace("{name}",I),setTimeout(function(){k.html(G)},100))},N=q.text,L=q.image,N(y.type,I)?f.readAsText(y,b.textEncoding):L(y.type,I)?f.readAsDataURL(y):f.readAsArrayBuffer(y)):(b._previewDefault(y,t),setTimeout(function(){C(g+1);b._updateFileDetails(p)},100),b._raise("fileloaded",[y,t,g,f])),b.addToStack(y)):
(b.addToStack(y),setTimeout(function(){C(g+1)},100),b._raise("fileloaded",[y,t,g,f]))}}};C(0);b._updateFileDetails(p,!1)},_updateFileDetails:function(a){var b=this.$element,c=this.getFileStack();b=e.isIE(9)&&e.findFileName(b.val())||b[0].files[0]&&b[0].files[0].name||c.length&&c[0].name||"";b=this.slug(b);c=this.isUploadable?c.length:a;var d=this.previewCache.count()+c;c=1<c?this._getMsgSelected(d):b;this.isError?(this.$previewContainer.removeClass("file-thumb-loading"),this.$previewStatus.html(""),
this.$captionContainer.find(".kv-caption-icon").hide()):this._showFileIcon();this._setCaption(c,this.isError);this.$container.removeClass("file-input-new file-input-ajax-new");1===arguments.length&&this._raise("fileselect",[a,b]);this.previewCache.count()&&this._initPreviewActions()},_setThumbStatus:function(a,b){if(this.showPreview){var c="indicator"+b,d=c+"Title",f="file-preview-"+b.toLowerCase(),e=a.find(".file-upload-indicator"),g=this.fileActionSettings;a.removeClass("file-preview-success file-preview-error file-preview-loading");
"Error"===b&&a.find(".kv-file-upload").attr("disabled",!0);"Success"===b&&(a.find(".file-drag-handle").remove(),e.css("margin-left",0));e.html(g[c]);e.attr("title",g[d]);a.addClass(f)}},_setProgressCancelled:function(){this._setProgress(101,this.$progress,this.msgCancelled)},_setProgress:function(a,b,c){var d=Math.min(a,100),f=this.progressUploadThreshold,g=100>=a?this.progressTemplate:this.progressCompleteTemplate;g=100>d?this.progressTemplate:c?this.progressErrorTemplate:g;b=b||this.$progress;e.isEmpty(g)||
(f&&d>f&&100>=a?d=g.replace(/\{percent}/g,f).replace(/\{status}/g,this.msgUploadThreshold):(a=100<a?this.msgUploadEnd:d+"%",d=g.replace(/\{percent}/g,d).replace(/\{status}/g,a)),b.html(d),c&&b.find('[role="progressbar"]').html(c))},_setFileDropZoneTitle:function(){var a=this.$container.find(".file-drop-zone"),b=this.dropZoneTitle;if(this.isClickable){var c=e.isEmpty(this.$element.attr("multiple"))?this.fileSingle:this.filePlural;b+=this.dropZoneClickTitle.replace("{files}",c)}a.find("."+this.dropZoneTitleClass).remove();
this.isUploadable&&this.showPreview&&0!==a.length&&!(0<this.getFileStack().length)&&this.dropZoneEnabled&&(0===a.find(e.FRAMES).length&&e.isEmpty(this.defaultPreviewContent)&&a.prepend('<div class="'+this.dropZoneTitleClass+'">'+b+"</div>"),this.$container.removeClass("file-input-new"),e.addCss(this.$container,"file-input-ajax-new"))},_setAsyncUploadStatus:function(a,b,c){var d=0;this._setProgress(b,g("#"+a).find(".file-thumb-progress"));this.uploadStatus[a]=b;g.each(this.uploadStatus,function(a,
b){d+=b});this._setProgress(Math.floor(d/c))},_validateMinCount:function(){var a=this.isUploadable?this.getFileStack().length:this.$element.get(0).files.length;return this.validateInitialCount&&0<this.minFileCount&&this._getFileCount(a-1)<this.minFileCount?(this._noFilesError({}),!1):!0},_getFileCount:function(a){if(this.validateInitialCount&&!this.overwriteInitial){var b=this.previewCache.count();a+=b}return a},_getFileName:function(a){return a&&a.name?this.slug(a.name):void 0},_getFileNames:function(a){return this.filenames.filter(function(b){return a?
void 0!==b:void 0!==b&&null!==b})},_setPreviewError:function(a,b,c){void 0!==b&&this.updateStack(b,c);this.removeFromPreviewOnError?a.remove():this._setThumbStatus(a,"Error")},_checkDimensions:function(a,b,c,d,f,g,k){var h=this[("Small"===b?"min":"max")+"Image"+g];!e.isEmpty(h)&&c.length&&(c=c[0],c="Width"===g?c.naturalWidth||c.width:c.naturalHeight||c.height,("Small"===b?c>=h:c<=h)||(b=this["msgImage"+g+b].replace("{name}",f).replace("{size}",h),this._showUploadError(b,k),this._setPreviewError(d,
a,null)))},_validateImage:function(a,b,c){var d=this,f=d.$preview,e,g,m,l=f.find("#"+a),r=l.attr("data-fileindex"),p=l.find("img");b=b||"Untitled";p.length&&d._handler(p,"load",function(){g=l.width();m=f.width();g>m&&(p.css("width","100%"),l.css("width","97%"));e={ind:r,id:a};d._checkDimensions(r,"Small",p,l,b,"Width",e);d._checkDimensions(r,"Small",p,l,b,"Height",e);d.resizeImage||(d._checkDimensions(r,"Large",p,l,b,"Width",e),d._checkDimensions(r,"Large",p,l,b,"Height",e));d._raise("fileimageloaded",
[a]);d.loadedImages.push({ind:r,img:p,thumb:l,pid:a,typ:c});d._validateAllImages()})},_validateAllImages:function(){var a,b={val:0},c=this.loadedImages.length;if(c===this.totalImagesCount&&(this._raise("fileimagesloaded"),this.resizeImage))for(a=0;a<this.loadedImages.length;a++)this._getResizedImage(this.loadedImages[a],b,c)},_getResizedImage:function(a,b,c){var d=this,f=g(a.img)[0],e=f.naturalWidth,k=f.naturalHeight,m=1;m=d.maxImageWidth||e;var l=d.maxImageHeight||k,r=!(!e||!k),p=d.imageCanvas,q=
d.imageCanvasContext,w=a.typ,u=a.pid,v=a.ind,z=a.thumb;var H=function(a,b,c){d.isUploadable?d._showUploadError(a,b,c):d._showError(a,b,c);d._setPreviewError(z,v)};if(!d.filestack[v]||!r||e<=m&&k<=l)if(r&&d.filestack[v]&&d._raise("fileimageresized",[u,v]),b.val++,b.val===c&&d._raise("fileimagesresized"),!r){H(d.msgImageResizeError,{id:u,index:v},"fileimageresizeerror");return}w=w||d.resizeDefaultImageType;a=e>m;r=k>l;m="width"===d.resizePreference?a?m/e:r?l/k:1:r?l/k:a?m/e:1;d._resetCanvas();e*=m;
k*=m;p.width=e;p.height=k;try{q.drawImage(f,0,0,e,k),p.toBlob(function(a){d.filestack[v]=a;d._raise("fileimageresized",[u,v]);b.val++;b.val===c&&d._raise("fileimagesresized",[void 0,void 0]);a instanceof Blob||H(d.msgImageResizeError,{id:u,index:v},"fileimageresizeerror")},w,d.resizeQuality)}catch(n){b.val++,b.val===c&&d._raise("fileimagesresized",[void 0,void 0]),f=d.msgImageResizeException.replace("{errors}",n.message),H(f,{id:u,index:v},"fileimageresizeexception")}},_initBrowse:function(a){this.showBrowse?
(this.$btnFile=a.find(".btn-file"),this.$btnFile.append(this.$element)):this.$element.hide()},_initCaption:function(){var a=this.initialCaption||"";if(this.overwriteInitial||e.isEmpty(a))return this.$caption.html(""),!1;this._setCaption(a);return!0},_setCaption:function(a,b){var c=this.getFileStack();if(this.$caption.length){if(b){var d=g("<div>"+this.msgValidationError+"</div>").text();var f=(f=c.length)?1===f&&c[0]?this._getFileNames()[0]:this._getMsgSelected(f):this._getMsgSelected(this.msgNo);
f='<span class="'+this.msgValidationErrorClass+'">'+this.msgValidationErrorIcon+(e.isEmpty(a)?f:a)+"</span>"}else{if(e.isEmpty(a))return;d=g("<div>"+a+"</div>").text();f=this._getLayoutTemplate("fileIcon")+d}this.$caption.html(f);this.$caption.attr("title",d);this.$captionContainer.find(".file-caption-ellipsis").attr("title",d)}},_createContainer:function(){var a=g(document.createElement("div")).attr({"class":"file-input file-input-new"}).html(this._renderMain());this.$element.before(a);this._initBrowse(a);
this.theme&&a.addClass("theme-"+this.theme);return a},_refreshContainer:function(){var a=this.$container;a.before(this.$element);a.html(this._renderMain());this._initBrowse(a)},_renderMain:function(){var a=this.isUploadable&&this.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",b=this.showClose?this._getLayoutTemplate("close"):"";a=this.showPreview?this._getLayoutTemplate("preview").replace(/\{class}/g,this.previewClass).replace(/\{dropClass}/g,a):"";var c=this.captionTemplate.replace(/\{class}/g,
(this.isDisabled?this.captionClass+" file-caption-disabled":this.captionClass)+" kv-fileinput-caption");return this.mainTemplate.replace(/\{class}/g,this.mainClass+(!this.showBrowse&&this.showCaption?" no-browse":"")).replace(/\{preview}/g,a).replace(/\{close}/g,b).replace(/\{caption}/g,c).replace(/\{upload}/g,this._renderButton("upload")).replace(/\{remove}/g,this._renderButton("remove")).replace(/\{cancel}/g,this._renderButton("cancel")).replace(/\{browse}/g,this._renderButton("browse"))},_renderButton:function(a){var b=
this._getLayoutTemplate("btnDefault"),c=this[a+"Class"],d=this[a+"Title"],f=this[a+"Icon"],g=this[a+"Label"],k=this.isDisabled?" disabled":"",m="button";switch(a){case "remove":if(!this.showRemove)return"";break;case "cancel":if(!this.showCancel)return"";c+=" hide";break;case "upload":if(!this.showUpload)return"";this.isUploadable&&!this.isDisabled?b=this._getLayoutTemplate("btnLink").replace("{href}",this.uploadUrl):m="submit";break;case "browse":if(!this.showBrowse)return"";b=this._getLayoutTemplate("btnBrowse");
break;default:return""}c+="browse"===a?" btn-file":" fileinput-"+a+" fileinput-"+a+"-button";e.isEmpty(g)||(g=' <span class="'+this.buttonLabelClass+'">'+g+"</span>");return b.replace("{type}",m).replace("{css}",c).replace("{title}",d).replace("{status}",k).replace("{icon}",f).replace("{label}",g)},_renderThumbProgress:function(){return'<div class="file-thumb-progress hide">'+this.progressTemplate.replace(/\{percent}/g,"0").replace(/\{status}/g,this.msgUploadBegin)+"</div>"},_renderFileFooter:function(a,
b,c,d){var f=this.fileActionSettings,g=f.showRemove,k=f.showDrag,m=f.showUpload,l=f.showZoom,r=this._getLayoutTemplate("footer"),p=d?f.indicatorError:f.indicatorNew;d=d?f.indicatorErrorTitle:f.indicatorNewTitle;b=this._getSize(b);a=this.isUploadable?r.replace(/\{actions}/g,this._renderFileActions(m,g,l,k,!1,!1,!1)).replace(/\{caption}/g,a).replace(/\{size}/g,b).replace(/\{width}/g,c).replace(/\{progress}/g,this._renderThumbProgress()).replace(/\{indicator}/g,p).replace(/\{indicatorTitle}/g,d):r.replace(/\{actions}/g,
this._renderFileActions(!1,!1,l,k,!1,!1,!1)).replace(/\{caption}/g,a).replace(/\{size}/g,b).replace(/\{width}/g,c).replace(/\{progress}/g,"").replace(/\{indicator}/g,p).replace(/\{indicatorTitle}/g,d);return a=e.replaceTags(a,this.previewThumbTags)},_renderFileActions:function(a,b,c,d,f,e,g,m){if(!(a||b||c||d))return"";e=!1===e?"":' data-url="'+e+'"';var h=!1===g?"":' data-key="'+g+'"',k=g="",p="",q="",w=this._getLayoutTemplate("actions"),u=this.fileActionSettings,v=this.otherActionButtons.replace(/\{dataKey}/g,
h);f=f?u.removeClass+" disabled":u.removeClass;b&&(g=this._getLayoutTemplate("actionDelete").replace(/\{removeClass}/g,f).replace(/\{removeIcon}/g,u.removeIcon).replace(/\{removeTitle}/g,u.removeTitle).replace(/\{dataUrl}/g,e).replace(/\{dataKey}/g,h));a&&(k=this._getLayoutTemplate("actionUpload").replace(/\{uploadClass}/g,u.uploadClass).replace(/\{uploadIcon}/g,u.uploadIcon).replace(/\{uploadTitle}/g,u.uploadTitle));c&&(p=this._getLayoutTemplate("actionZoom").replace(/\{zoomClass}/g,u.zoomClass).replace(/\{zoomIcon}/g,
u.zoomIcon).replace(/\{zoomTitle}/g,u.zoomTitle));d&&m&&(a="drag-handle-init "+u.dragClass,q=this._getLayoutTemplate("actionDrag").replace(/\{dragClass}/g,a).replace(/\{dragTitle}/g,u.dragTitle).replace(/\{dragIcon}/g,u.dragIcon));return w.replace(/\{delete}/g,g).replace(/\{upload}/g,k).replace(/\{zoom}/g,p).replace(/\{drag}/g,q).replace(/\{other}/g,v)},_browse:function(a){this._raise("filebrowse");a&&a.isDefaultPrevented()||(this.isError&&!this.isUploadable&&this.clear(),this.$captionContainer.focus())},
_change:function(a){var b=this.$element;if(!this.isUploadable&&e.isEmpty(b.val())&&this.fileInputCleared)this.fileInputCleared=!1;else{this.fileInputCleared=!1;var c=1<arguments.length;var d=this.isUploadable;var f=0;var h=c?a.originalEvent.dataTransfer.files:b.get(0).files,k=this.filestack.length;b=e.isEmpty(b.attr("multiple"))&&0<k;var m=0;this.reader=null;this._resetUpload();this._hideFileIcon();this.isUploadable&&this.$container.find(".file-drop-zone ."+this.dropZoneTitleClass).remove();if(c)for(c=
[];h[f];){var l=h[f];l.type||0!==l.size%4096?c.push(l):m++;f++}else c=void 0===a.target.files?a.target&&a.target.value?[{name:a.target.value.replace(/^.+\\/,"")}]:[]:a.target.files;if(e.isEmpty(c)||0===c.length)d||this.clear(),this._showFolderError(m),this._raise("fileselectnone");else{this._resetErrors();l=c.length;f=this._getFileCount(this.isUploadable?this.getFileStack().length+l:l);if(0<this.maxFileCount&&f>this.maxFileCount){if(!this.autoReplace||l>this.maxFileCount){d=this.autoReplace&&l>this.maxFileCount?
l:f;d=this.msgFilesTooMany.replace("{m}",this.maxFileCount).replace("{n}",d);k=g.extend(!0,{},this._getOutData({},{},h),{id:null,index:null});h={id:null,index:null,file:null,files:h};this.isError=this.isUploadable?this._showUploadError(d,k):this._showError(d,h);this.$captionContainer.find(".kv-caption-icon").hide();this._setCaption("",!0);this.$container.removeClass("file-input-new file-input-ajax-new");return}f>this.maxFileCount&&this._resetPreviewThumbs(d)}else!d||b?(this._resetPreviewThumbs(!1),
b&&this.clearStack()):!d||0!==k||this.previewCache.count()&&!this.overwriteInitial||this._resetPreviewThumbs(!0);this.isPreviewable?this._readFiles(c):this._updateFileDetails(1);this._showFolderError(m)}}},_abort:function(a){return this.ajaxAborted&&"object"===typeof this.ajaxAborted&&void 0!==this.ajaxAborted.message?(a=g.extend(!0,{},this._getOutData(),a),a.abortData=this.ajaxAborted.data||{},a.abortMessage=this.ajaxAborted.message,this.cancel(),this._setProgress(101,this.$progress,this.msgCancelled),
this._showUploadError(this.ajaxAborted.message,a,"filecustomerror"),!0):!1},_resetFileStack:function(){var a=this,b=0,c=[],d=[];a._getThumbs().each(function(){var f=g(this),e=f.attr("data-fileindex"),k=a.filestack[e];-1!==e&&(void 0!==k?(c[b]=k,d[b]=a._getFileName(k),f.attr({id:a.previewInitId+"-"+b,"data-fileindex":b}),b++):f.attr({"data-fileindex":"-1"}))});a.filestack=c;a.filenames=d},clearStack:function(){this.filestack=[];this.filenames=[];return this.$element},updateStack:function(a,b){this.filestack[a]=
b;this.filenames[a]=this._getFileName(b);return this.$element},addToStack:function(a){this.filestack.push(a);this.filenames.push(this._getFileName(a));return this.$element},getFileStack:function(a){return this.filestack.filter(function(b){return a?void 0!==b:void 0!==b&&null!==b})},getFilesCount:function(){var a=this.isUploadable?this.getFileStack().length:this.$element.get(0).files.length;return this._getFileCount(a)},lock:function(){this._resetErrors();this.disable();this.showRemove&&e.addCss(this.$container.find(".fileinput-remove"),
"hide");this.showCancel&&this.$container.find(".fileinput-cancel").removeClass("hide");this._raise("filelock",[this.filestack,this._getExtraData()]);return this.$element},unlock:function(a){void 0===a&&(a=!0);this.enable();this.showCancel&&e.addCss(this.$container.find(".fileinput-cancel"),"hide");this.showRemove&&this.$container.find(".fileinput-remove").removeClass("hide");a&&this._resetFileStack();this._raise("fileunlock",[this.filestack,this._getExtraData()]);return this.$element},cancel:function(){var a=
this,b=a.ajaxRequests,c=b.length,d;if(0<c)for(d=0;d<c;d+=1)a.cancelling=!0,b[d].abort();a._setProgressCancelled();a._getThumbs().each(function(){var b=g(this),c=b.attr("data-fileindex");b.removeClass("file-uploading");void 0!==a.filestack[c]&&(b.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),b.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled"));a.unlock()});return a.$element},clear:function(){var a=this;if(a._raise("fileclear")){a.$btnUpload.removeAttr("disabled");
a._getThumbs().find("video,audio,img").each(function(){e.cleanMemory(g(this))});a._resetUpload();a.clearStack();a._clearFileInput();a._resetErrors(!0);if(a._hasInitialPreview())a._showFileIcon(),a._resetPreview(),a._initPreviewActions(),a.$container.removeClass("file-input-new");else{a._getThumbs().each(function(){a._clearObjects(g(this))});a.isUploadable&&(a.previewCache.data={});a.$preview.html("");var b=!a.overwriteInitial&&0<a.initialCaption.length?a.initialCaption:"";a.$caption.html(b);a.$caption.attr("title",
"");e.addCss(a.$container,"file-input-new");a._validateDefaultPreview()}0===a.$container.find(e.FRAMES).length&&(a._initCaption()||a.$captionContainer.find(".kv-caption-icon").hide());a._hideFileIcon();a._raise("filecleared");a.$captionContainer.focus();a._setFileDropZoneTitle();return a.$element}},reset:function(){if(this._raise("filereset"))return this._resetPreview(),this.$container.find(".fileinput-filename").text(""),e.addCss(this.$container,"file-input-new"),(this.$preview.find(e.FRAMES).length||
this.isUploadable&&this.dropZoneEnabled)&&this.$container.removeClass("file-input-new"),this._setFileDropZoneTitle(),this.clearStack(),this.formdata={},this.$element},disable:function(){this.isDisabled=!0;this._raise("filedisabled");this.$element.attr("disabled","disabled");this.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled");this.$container.find(".btn-file, .fileinput-upload, .file-preview-frame button").attr("disabled",!0);this._initDragDrop();return this.$element},enable:function(){this.isDisabled=
!1;this._raise("fileenabled");this.$element.removeAttr("disabled");this.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled");this.$container.find(".btn-file,  .fileinput-upload, .file-preview-frame button").removeAttr("disabled");this._initDragDrop();return this.$element},upload:function(){var a=this.getFileStack().length,b={},c=!g.isEmptyObject(this._getExtraData());if(this.isUploadable&&!this.isDisabled)if(0<this.minFileCount&&this._getFileCount(a)<this.minFileCount)this._noFilesError(b);
else if(this._resetUpload(),0!==a||c)if(this.$progress.removeClass("hide"),this.uploadCount=0,this.uploadStatus={},this.uploadLog=[],this.lock(),this._setProgress(2),0===a&&c)this._uploadExtraOnly();else if(a=this.filestack.length,this.hasInitData=!1,this.uploadAsync){b=this._getOutData();this._raise("filebatchpreupload",[b]);this.fileBatchCompleted=!1;this.uploadCache={content:[],config:[],tags:[],append:!0};this.uploadAsyncCount=this.getFileStack().length;for(b=0;b<a;b++)this.uploadCache.content[b]=
null,this.uploadCache.config[b]=null,this.uploadCache.tags[b]=null;this.$preview.find(".file-preview-initial").removeClass(e.SORT_CSS);this._initSortable();this.cacheInitialPreview=this.getPreview();for(b=0;b<a;b++)void 0!==this.filestack[b]&&this._uploadSingle(b,this.filestack,!0)}else return this._uploadBatch(),this.$element;else this._showUploadError(this.msgUploadEmpty)},destroy:function(){var a=this.$form,b=this.$container,c=this.$element,d=this.namespace;g(document).off(d);g(window).off(d);
a&&a.length&&a.off(d);c.insertBefore(b).off(d).removeData();b.off().remove();return c},refresh:function(a){var b=this.$element;a=a?g.extend(!0,{},this.options,a):this.options;this.destroy();b.fileinput(a);b.val()&&b.trigger("change.fileinput");return b},zoom:function(a){var b=g("#"+a),c=this.$modal;b.length?(e.initModal(c),c.html(this._getModalContent()),this._setZoomContent(b),c.modal("show"),this._initZoomButtons()):this._log('Cannot zoom to detailed preview! Invalid frame with id: "'+a+'".')},
getPreview:function(){return{content:this.initialPreview,config:this.initialPreviewConfig,tags:this.initialPreviewThumbTags}}};g.fn.fileinput=function(a){if(e.hasFileAPISupport()||e.isIE(9)){var b=Array.apply(null,arguments),c=[];b.shift();this.each(function(){var d=g(this),f=d.data("fileinput"),h="object"===typeof a&&a,k=h.theme||d.data("theme"),m={},l={},r=h.language||d.data("language")||g.fn.fileinput.defaults.language||"en";f||(k&&(l=g.fn.fileinputThemes[k]||{}),"en"===r||e.isEmpty(g.fn.fileinputLocales[r])||
(m=g.fn.fileinputLocales[r]||{}),f=g.extend(!0,{},g.fn.fileinput.defaults,l,g.fn.fileinputLocales.en,m,h,d.data()),f=new z(this,f),d.data("fileinput",f));"string"===typeof a&&c.push(f[a].apply(f,b))});switch(c.length){case 0:return this;case 1:return c[0];default:return c}}};g.fn.fileinput.defaults={language:"en",showCaption:!0,showBrowse:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showClose:!0,showUploadedThumbs:!0,browseOnZoneClick:!1,autoReplace:!1,previewClass:"",captionClass:"",
frameClass:"krajee-default",mainClass:"file-caption-main",mainTemplate:null,purifyHtml:!0,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"></i>',next:'<i class="glyphicon glyphicon-triangle-right"></i>',
toggleheader:'<i class="glyphicon glyphicon-resize-vertical"></i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"></i>',borderless:'<i class="glyphicon glyphicon-resize-full"></i>',close:'<i class="glyphicon glyphicon-remove"></i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-default btn-header-toggle",fullscreen:"btn btn-default",borderless:"btn btn-default",close:"btn btn-default"},preferIconicPreview:!1,preferIconicZoomPreview:!1,allowedPreviewTypes:void 0,
allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-default",
cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",minFileSize:0,maxFileSize:0,maxFilePreviewSize:256E4,minFileCount:0,maxFileCount:0,validateInitialCount:!1,
msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar progress-bar-success progress-bar-striped active",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",progressErrorClass:"progress-bar progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",elCaptionContainer:null,elCaptionText:null,
elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:'<span class="close kv-error-close">&times;</span>',slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0};g.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",
cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgZoomModalHeading:"Detailed Preview",msgSizeTooSmall:'File "{name}" (<b>{size} KB</b>) is too small and must be larger than <b>{minSize} KB</b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload.",
msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',
msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing...",msgUploadBegin:"Initializing...",msgUploadEnd:"Done",msgUploadEmpty:"No valid data available for upload.",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",
msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',
msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}</pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",
previewZoomButtonTitles:{prev:"View previous file",next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}};g.fn.fileinput.Constructor=z;g(document).ready(function(){var a=g("input.file[type=file]");a.length&&a.fileinput()})});
(function(g){g.fn.fileinputThemes.explorer={layoutTemplates:{preview:'<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <table class="table table-bordered table-hover"><tbody class="file-preview-thumbnails">\n    </tbody></table>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',footer:'<td class="file-details-cell"><div class="explorer-caption" title="{caption}">{caption}</div> {size}{progress}</td><td class="file-actions-cell">{indicator} {actions}</td>',
actions:'{drag}\n<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload} {delete} {zoom} {other}     </div>\n</div>',zoomCache:'<tr style="display:none" class="kv-zoom-cache-theme"><td><table class="kv-zoom-cache">{zoomContent}</table></td></tr>'},previewMarkupTags:{tagBefore1:'<tr class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"><td class="kv-file-content">\n',tagBefore2:'<tr class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}" title="{caption}"><td class="kv-file-content">\n',
tagAfter:"</td>\n{footer}</tr>\n"},previewSettings:{image:{height:"60px"},html:{width:"100px",height:"60px"},text:{width:"100px",height:"60px"},video:{width:"auto",height:"60px"},audio:{width:"auto",height:"60px"},flash:{width:"100%",height:"60px"},object:{width:"100%",height:"60px"},pdf:{width:"100px",height:"60px"},other:{width:"100%",height:"60px"}},frameClass:"explorer-frame"}})(window.jQuery);
